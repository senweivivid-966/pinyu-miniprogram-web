<!--pages/edit-profile/index.wxml-->
<view class="edit-profile-page">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="top-nav">
    <view class="nav-content">
      <view class="nav-left" bindtap="onBack">
        <text class="back-icon">â€¹</text>
        <text class="back-text">è¿”å›</text>
      </view>
      <view class="nav-title">ç¼–è¾‘èµ„æ–™</view>
      <view class="nav-right">
        <button 
          class="save-btn {{saving ? 'saving' : ''}}" 
          bindtap="onSave"
          disabled="{{saving}}"
        >
          {{saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'}}
        </button>
      </view>
    </view>
  </view>

  <!-- è¡¨å•å†…å®¹ -->
  <scroll-view class="form-container" scroll-y>
    <!-- å¤´åƒéƒ¨åˆ† -->
    <view class="form-section">
      <view class="section-title">å¤´åƒ</view>
      <view class="avatar-section" bindtap="onAvatarTap">
        <image class="avatar-preview" src="{{userInfo.avatar}}" mode="aspectFill" />
        <view class="avatar-edit">
          <text class="edit-icon">ğŸ“·</text>
          <text class="edit-text">ç‚¹å‡»æ›´æ¢</text>
        </view>
      </view>
    </view>

    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="form-section">
      <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
      
      <!-- å§“å -->
      <view class="form-item">
        <view class="item-label">å§“å *</view>
        <input 
          class="item-input" 
          placeholder="è¯·è¾“å…¥å§“å"
          value="{{userInfo.name}}"
          data-field="name"
          bindinput="onInputChange"
          maxlength="20"
        />
      </view>

      <!-- å¹´é¾„ -->
      <view class="form-item">
        <view class="item-label">å¹´é¾„</view>
        <picker 
          mode="selector" 
          range="{{[18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50]}}"
          value="{{userInfo.age - 18}}"
          bindchange="onAgeChange"
        >
          <view class="picker-value">{{userInfo.age}}å²</view>
        </picker>
      </view>

      <!-- æ€§åˆ« -->
      <view class="form-item">
        <view class="item-label">æ€§åˆ«</view>
        <picker 
          mode="selector" 
          range="{{genderOptions}}"
          range-key="label"
          value="{{genderSelectedIndex}}"
          bindchange="onGenderChange"
        >
          <view class="picker-value">
            {{genderSelectedLabel}}
          </view>
        </picker>
      </view>

      <!-- åŸå¸‚ -->
      <view class="form-item">
        <view class="item-label">æ‰€åœ¨åŸå¸‚</view>
        <picker 
          mode="selector" 
          range="{{cityList}}"
          value="{{cityList.indexOf(userInfo.city)}}"
          bindchange="onCityChange"
        >
          <view class="picker-value">{{userInfo.city}}</view>
        </picker>
      </view>

      <!-- èº«é«˜ -->
      <view class="form-item">
        <view class="item-label">èº«é«˜</view>
        <picker 
          mode="selector" 
          range="{{[150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190]}}"
          value="{{userInfo.height - 150}}"
          bindchange="onHeightChange"
        >
          <view class="picker-value">{{userInfo.height}}cm</view>
        </picker>
      </view>
    </view>

    <!-- èŒä¸šä¿¡æ¯ -->
    <view class="form-section">
      <view class="section-title">èŒä¸šä¿¡æ¯</view>
      
      <!-- èŒä¸š -->
      <view class="form-item">
        <view class="item-label">èŒä¸š</view>
        <input 
          class="item-input" 
          placeholder="è¯·è¾“å…¥èŒä¸š"
          value="{{userInfo.occupation}}"
          data-field="occupation"
          bindinput="onInputChange"
          maxlength="30"
        />
      </view>

      <!-- å…¬å¸ -->
      <view class="form-item">
        <view class="item-label">å…¬å¸</view>
        <input 
          class="item-input" 
          placeholder="è¯·è¾“å…¥å…¬å¸åç§°"
          value="{{userInfo.company}}"
          data-field="company"
          bindinput="onInputChange"
          maxlength="50"
        />
      </view>

      <!-- å­¦å† -->
      <view class="form-item">
        <view class="item-label">å­¦å†</view>
        <picker 
          mode="selector" 
          range="{{educationOptions}}"
          range-key="label"
          value="{{educationOptions.findIndex(item => item.value === userInfo.education)}}"
          bindchange="onEducationChange"
        >
          <view class="picker-value">
            {{educationOptions.find(item => item.value === userInfo.education).label}}
          </view>
        </picker>
      </view>

      <!-- æ”¶å…¥ -->
      <view class="form-item">
        <view class="item-label">æ”¶å…¥</view>
        <picker 
          mode="selector" 
          range="{{incomeOptions}}"
          range-key="label"
          value="{{incomeOptions.findIndex(item => item.value === userInfo.income)}}"
          bindchange="onIncomeChange"
        >
          <view class="picker-value">
            {{incomeOptions.find(item => item.value === userInfo.income).label}}
          </view>
        </picker>
      </view>
    </view>

    <!-- ç”Ÿæ´»ä¹ æƒ¯ -->
    <view class="form-section">
      <view class="section-title">ç”Ÿæ´»ä¹ æƒ¯</view>
      
      <!-- å¸çƒŸ -->
      <view class="form-item">
        <view class="item-label">å¸çƒŸ</view>
        <picker 
          mode="selector" 
          range="{{smokingOptions}}"
          range-key="label"
          value="{{smokingOptions.findIndex(item => item.value === userInfo.smoking)}}"
          bindchange="onSmokingChange"
        >
          <view class="picker-value">
            {{smokingOptions.find(item => item.value === userInfo.smoking).label}}
          </view>
        </picker>
      </view>

      <!-- é¥®é…’ -->
      <view class="form-item">
        <view class="item-label">é¥®é…’</view>
        <picker 
          mode="selector" 
          range="{{drinkingOptions}}"
          range-key="label"
          value="{{drinkingOptions.findIndex(item => item.value === userInfo.drinking)}}"
          bindchange="onDrinkingChange"
        >
          <view class="picker-value">
            {{drinkingOptions.find(item => item.value === userInfo.drinking).label}}
          </view>
        </picker>
      </view>
    </view>

    <!-- ä¸ªäººç®€ä»‹ -->
    <view class="form-section">
      <view class="section-title">ä¸ªäººç®€ä»‹ *</view>
      <view class="form-item textarea-item">
        <textarea 
          class="item-textarea" 
          placeholder="ä»‹ç»ä¸€ä¸‹è‡ªå·±ï¼Œè®©åˆ«äººæ›´äº†è§£ä½ ..."
          value="{{userInfo.bio}}"
          data-field="bio"
          bindinput="onInputChange"
          maxlength="200"
          show-confirm-bar="{{false}}"
          auto-height
        />
        <view class="char-count">{{userInfo.bio.length}}/200</view>
      </view>
    </view>

    <!-- åº•éƒ¨é—´è· -->
    <view class="bottom-spacing"></view>
  </scroll-view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-overlay">
    <view class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>