<!--pages/messages/index.wxml-->
<view class="messages-page">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="top-nav">
    <view class="nav-content">
      <view class="nav-title">ç§ä¿¡</view>
      <view class="nav-actions">
        <view class="search-btn" bindtap="toggleSearch">
          <text class="search-icon">ğŸ”</text>
        </view>
      </view>
    </view>
    
    <!-- æœç´¢æ  -->
    <view class="search-bar {{showSearch ? 'show' : ''}}">
      <input 
        class="search-input"
        placeholder="æœç´¢è”ç³»äººæˆ–æ¶ˆæ¯"
        value="{{searchQuery}}"
        bindinput="onSearchInput"
        focus="{{showSearch}}"
      />
    </view>
  </view>

  <!-- ä¼šè¯åˆ—è¡¨ -->
  <scroll-view 
    class="conversation-list" 
    scroll-y="true"
    refresher-enabled="true"
    bindrefresherrefresh="onPullDownRefresh"
  >
    <view class="conversations">
      <view 
        wx:for="{{conversations}}" 
        wx:key="id" 
        class="conversation-item"
        data-id="{{item.id}}"
        data-user-id="{{item.userId}}"
        data-user-name="{{item.userName}}"
        bindtap="onConversationTap"
        bindlongpress="onDeleteConversation"
      >
        <!-- ç”¨æˆ·å¤´åƒ -->
        <view class="user-avatar-container">
          <image 
            class="user-avatar" 
            src="{{item.userAvatar}}" 
            mode="aspectFill"
          />
          <view wx:if="{{item.isOnline}}" class="online-indicator"></view>
          <view wx:if="{{item.unreadCount > 0}}" class="unread-badge">
            {{item.unreadCount > 99 ? '99+' : item.unreadCount}}
          </view>
        </view>

        <!-- ä¼šè¯ä¿¡æ¯ -->
        <view class="conversation-info">
          <view class="conversation-header">
            <text class="user-name">{{item.userName}}</text>
            <text class="message-time">{{item.lastMessageTime}}</text>
          </view>
          
          <view class="last-message">
            <text class="message-content {{item.unreadCount > 0 ? 'unread' : ''}}">
              {{item.messageType === 'image' ? '[å›¾ç‰‡]' : item.lastMessage}}
            </text>
          </view>
        </view>

        <!-- å³ä¾§ç®­å¤´ -->
        <view class="conversation-arrow">
          <text class="arrow-icon">â€º</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-container" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{conversations.length === 0 && !loading}}">
      <image class="empty-icon" src="/assets/images/empty-messages.svg" />
      <text class="empty-title">æš‚æ— æ¶ˆæ¯</text>
      <text class="empty-subtitle">å¼€å§‹ä¸å…¶ä»–ä¼šå‘˜èŠå¤©å§</text>
      <button class="empty-btn" bindtap="goToMeet">å»ç›¸é‡</button>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨å¯¼èˆª -->
  <bottom-navbar current-tab="message" bind:navchange="onNavChange" />
</view>