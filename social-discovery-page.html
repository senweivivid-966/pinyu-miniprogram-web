<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>频遇小程序 - Web预览版</title>
    <link rel="stylesheet" href="components/bottom-navbar.css">
    <style>
        /* 重置样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: #f8fafc;
            color: #1f2937;
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
        }

        /* 主题色彩变量 */
        :root {
            --primary-color: #FF6B9D;
            --secondary-color: #EC4899;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --border-color: rgba(0, 0, 0, 0.05);
        }

        /* 模拟小程序顶部导航栏样式 - 精确复刻截图1 */
        .miniprogram-navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: white;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 24px;
            z-index: 1000;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .navbar-left {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-width: auto;
            margin-right: 12px;
            padding: 2px 4px;
            line-height: 1;
            height: 40px;
            margin-top: 12px;
        }

        .navbar-brand-unified {
            font-size: 16px;
            font-weight: bold;
            color: #333333;
            line-height: 1.2;
            letter-spacing: 0;
            margin: 0;
            padding: 0;
            display: block;
            margin-top: 0px;
        }

        .navbar-center {
            display: flex;
            gap: 16px;
            flex: none;
            justify-content: center;
            align-items: center;
        }

        .nav-item {
            color: #333333;
            text-decoration: none;
            font-size: 16px;
            font-weight: 400;
            padding: 8px 0;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .nav-item-multiline {
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1.2;
            justify-content: space-between;
            height: 40px;
        }

        .nav-line {
            display: block;
            writing-mode: horizontal-tb;
            text-orientation: mixed;
        }

        .nav-line:first-child {
            align-self: flex-start;
            margin-bottom: 0;
        }
        
        .nav-line:last-child {
            align-self: flex-start;
            margin-bottom: 0;
        }

        /* 移动端触摸反馈支持 - 顶部导航 */
        .nav-item {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .nav-item:active,
        .nav-item:focus,
        .nav-item.active-touch {
            transform: scale(0.95);
            transition: transform 0.1s ease;
        }

        .nav-item:active .nav-line,
        .nav-item:focus .nav-line,
        .nav-item.active-touch .nav-line {
            background: linear-gradient(135deg, #6e15ff 0%, #8735fd 50%, #9e2cf8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
        }

        .nav-item:hover {
            color: #666;
        }

        .nav-item.active {
            color: #333333;
            font-weight: 500;
        }

        .navbar-right {
            display: flex;
            align-items: center;
            min-width: auto;
            justify-content: flex-end;
            margin-left: 10px;
            margin-right: 15px;
        }

        .message-badge {
            position: absolute;
            top: -5px;
            right: -15px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            padding: 0;
            font-size: 10px;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            writing-mode: horizontal-tb;
            text-orientation: mixed;
            z-index: 10;
        }

        /* 模拟小程序底部TabBar样式 - 精确复刻截图2 */
        .miniprogram-tabbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: white;
            border-top: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px 30px 18px 30px;
            z-index: 1000;
            box-shadow: 0 -1px 3px rgba(0,0,0,0.05);
        }

        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 4px 0px;
            text-decoration: none;
            color: #8e8e93;
            margin: 0 8px;
            max-width: 60px;
        }

        .tab-item.active {
            color: #1a1a1a;
        }

        .tab-icon {
            font-size: 22px;
            margin-bottom: 3px;
            transition: all 0.2s ease;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333333;
        }

        .tab-icon svg {
            width: 100%;
            height: 100%;
            fill: #333333;
        }

        .tab-text {
            font-size: 15px;
            color: #333333;
            font-weight: 500;
            line-height: 1.2;
            transition: all 0.2s ease;
        }

        .tab-item:first-child .tab-text {
            font-weight: 400;
        }

        .tab-item.active .tab-icon {
            color: #333333;
        }

        .tab-item.active .tab-text {
            color: #333333;
            font-weight: 500;
        }

        .tab-item:hover .tab-icon,
        .tab-item:hover .tab-text {
            color: #666;
        }

        /* 添加点击效果样式 */
        /* 移动端触摸反馈支持 */
        .tab-item {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .tab-item:active,
        .tab-item:focus,
        .tab-item.active-touch {
            transform: scale(0.95);
            transition: transform 0.1s ease;
        }

        .tab-item:active .tab-text,
        .tab-item:focus .tab-text,
        .tab-item.active-touch .tab-text {
            background: linear-gradient(135deg, #6e15ff 0%, #8735fd 50%, #9e2cf8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
        }

        .tab-item:active .tab-icon,
        .tab-item:focus .tab-icon,
        .tab-item.active-touch .tab-icon {
            color: #6e15ff;
        }

        /* 发布图标特殊样式 */
        .publish-icon {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .publish-badge {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6e15ff 0%, #8735fd 50%, #9e2cf8 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            flex-shrink: 0;
            aspect-ratio: 1;
        }

        .publish-badge svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
            fill: white;
        }

        /* 调整容器页面的内边距 */
        .container-page {
            max-width: 100%;
            width: 100%;
            margin: 0 auto;
            padding: 16px;
            padding-top: 80px; /* 为顶部导航栏留出空间 */
            padding-bottom: 75px; /* 为底部导航栏留出空间 */
            min-height: 100vh;
            background: linear-gradient(180deg, #fdf2f8 0%, #f8f9fa 100%);
            position: relative;
            z-index: 1;
        }

        /* 立即加入板块样式 */
        .join-section {
            margin: 16px 0;
            padding: 0 4px;
            display: block !important;
            visibility: visible !important;
        }
        
        .join-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 24px;
            padding: 12px 16px;
            text-align: center;
            color: white;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
            display: flex !important;
            justify-content: space-between;
            align-items: center;
            visibility: visible !important;
        }

        .join-content {
            text-align: left;
            flex: 1;
        }
        
        .join-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .join-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 4px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            letter-spacing: 0.5px;
        }
        
        .join-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
            line-height: 1.2;
        }
        
        .join-button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .join-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }

        /* 会员头像轮播样式 */
        .members-carousel-section {
            margin: 20px 0;
            padding: 0 4px;
        }
        
        .members-carousel-container {
            background: transparent;
            border-radius: 16px;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .members-carousel-track {
            display: flex;
            gap: 16px;
            animation: scroll 20s linear infinite;
        }
        
        .member-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: 16px;
            flex-shrink: 0;
        }
        
        .member-avatar {
            flex-shrink: 0;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            border: 3px solid rgba(255,255,255,0.8);
            margin-bottom: 6px;
        }
        
        .member-name {
            font-size: 10px;
            color: #666;
            text-align: center;
            font-weight: 500;
            white-space: nowrap;
        }
        
        .member-avatar svg {
            width: 40px;
            height: 40px;
        }
        
        @keyframes scroll {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-50%);
            }
        }

        /* 独立渐变背景卡片样式 */
        /* 兴趣发现轮播海报区样式 */
        .interest-carousel-section {
            margin: 20px 0;
            padding: 0 4px;
        }
        
        .interest-carousel-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 40%; /* 调整高度比例 */
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .interest-carousel-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            border-radius: 16px;
        }
        
        .interest-carousel-slide.active {
            opacity: 1;
        }
        
        .interest-slide-content {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: #333;
            position: relative;
        }
        
        .interest-slide-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .interest-slide-bg {
            width: 100%;
            height: 100%;
            border-radius: 16px;
        }
        
        .interest-card-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            line-height: 1.3;
            background: linear-gradient(135deg, #6e15ff 0%, #8735fd 50%, #9e2cf8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .interest-card-subtitle {
            font-size: 14px;
            opacity: 0.8;
            line-height: 1.4;
            background: linear-gradient(135deg, #6e15ff 0%, #8735fd 50%, #9e2cf8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .interest-carousel-indicators {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
        }
        
        .interest-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .interest-indicator.active {
            background: var(--primary-color);
            transform: scale(1.2);
        }

        /* 轮播海报栏样式 */
        .carousel-section {
            margin: 20px 0;
            padding: 0 4px;
        }
        
        .carousel-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 比例 (9/16 * 100%) */
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .carousel-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            border-radius: 16px;
            overflow: hidden;
        }
        
        .carousel-slide.active {
            opacity: 1;
        }
        
        .slide-content {
            display: flex;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            align-items: center;
            gap: 20px;
        }
        
        .brand-info {
            flex: 1;
            color: white;
        }
        
        .brand-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            cursor: pointer !important;
            position: relative;
            z-index: 100;
            user-select: none;
        }
        
        .brand-title:hover {
            opacity: 0.8;
            transform: scale(1.02);
            transition: all 0.2s ease;
        }
        
        .brand-subtitle {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
            opacity: 0.9;
        }
        
        .brand-description {
            font-size: 12px;
            margin-bottom: 8px;
            opacity: 0.8;
            line-height: 1.4;
        }
        
        .brand-slogan {
            font-size: 13px;
            font-weight: 600;
            font-style: italic;
            opacity: 0.9;
        }
        
        .phone-mockup {
            width: 80px;
            height: auto;
            min-height: 160px;
            background: #E5E7EB;
            border-radius: 12px;
            padding: 3px;
            position: relative;
            flex-shrink: 0;
        }
        
        .phone-screen {
            width: 100%;
            height: auto;
            min-height: 154px;
            background: #fff;
            border-radius: 10px;
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .match-card {
            background: #fff;
            border-radius: 8px;
            padding: 6px;
            color: #333;
            text-align: center;
            width: 100%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            height: auto;
            min-height: 130px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .match-avatar {
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        .match-name {
            font-size: 9px;
            font-weight: 600;
            margin-bottom: 2px;
            background: linear-gradient(135deg, #FF6B9D, #EC4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .match-details {
            font-size: 7px;
            opacity: 0.7;
            margin-bottom: 2px;
        }
        
        .match-interests {
            font-size: 6px;
            opacity: 0.6;
            margin-bottom: 3px;
        }
        
        .match-score {
            font-size: 8px;
            font-weight: 600;
            background: linear-gradient(135deg, #FF6B9D, #EC4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            padding: 1px 6px;
            border-radius: 8px;
            display: inline-block;
            border: 1px solid #FF6B9D;
        }



        /* 动画效果 */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }



        /* 编辑模式样式 */
        .edit-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            z-index: 10000;
            border: 2px solid #FF6B9D;
        }
        
        /* 轮播编辑相关样式 */
        .carousel-edit-container {
            padding: 20px;
        }
        
        .carousel-images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .carousel-image-item {
            text-align: center;
        }
        
        .carousel-image-item .image-preview {
            width: 100%;
            height: 120px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            background: #f9f9f9;
            position: relative;
            overflow: hidden;
            transition: border-color 0.3s ease;
        }
        
        .carousel-image-item .image-preview:hover {
            border-color: #007bff;
        }
        
        .carousel-image-item .upload-text {
            color: #666;
            font-size: 13px;
            text-align: center;
            line-height: 1.4;
        }
        
        .upload-buttons {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .carousel-image-item .upload-btn,
        .carousel-image-item .remove-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 60px;
        }
        
        .carousel-image-item .upload-btn {
            background: #007bff;
            color: white;
        }
        
        .carousel-image-item .upload-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        
        .carousel-image-item .remove-btn {
            background: #dc3545;
            color: white;
        }
        
        .carousel-image-item .remove-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .modal-actions .save-btn {
            background: #28a745;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .modal-actions .save-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }
        
        .modal-actions .reset-btn {
            background: #ffc107;
            color: #212529;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .modal-actions .reset-btn:hover {
            background: #e0a800;
            transform: translateY(-1px);
        }
        
        .modal-actions .cancel-btn {
            background: #6c757d;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .modal-actions .cancel-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }
        
        .modal-actions .cancel-btn {
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .edit-panel-header {
            background: linear-gradient(135deg, #FF6B9D, #EC4899);
            color: white;
            padding: 15px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .edit-panel-header h3 {
            margin: 0;
            font-size: 16px;
        }
        
        .header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .undo-btn {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .undo-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .undo-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .backup-btn, .history-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 8px;
        }
        
        .backup-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }
        
        .history-btn {
            background: #17a2b8;
        }
        
        .history-btn:hover {
            background: #138496;
            transform: translateY(-1px);
        }

        .edit-panel-content {
            padding: 20px;
        }

        .edit-section {
            margin-bottom: 20px;
        }

        .edit-section h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #333;
        }

        .edit-btn {
            display: block;
            width: 100%;
            padding: 8px 12px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .edit-btn:hover {
            background: #e9ecef;
            border-color: #FF6B9D;
        }

        .edit-btn:last-child {
            margin-bottom: 0;
        }

        /* 图片编辑模态框样式 */
        .image-edit-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow: hidden;
        }

        .modal-header {
            background: linear-gradient(135deg, #FF6B9D, #EC4899);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 16px;
        }

        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .upload-area {
            text-align: center;
            margin-bottom: 20px;
        }

        .upload-btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 0 10px 10px 0;
            background: linear-gradient(135deg, #FF6B9D, #EC4899);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .upload-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 107, 157, 0.3);
        }

        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }

        .preview-item {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            background: #f8f9fa;
        }

        .preview-item img {
            width: 100%;
            height: 80px;
            object-fit: cover;
        }

        .preview-item button {
            width: 50%;
            padding: 5px;
            border: none;
            font-size: 10px;
            cursor: pointer;
        }

        .remove-btn {
            background: #dc3545;
            color: white;
        }

        .apply-btn {
            background: #28a745;
            color: white;
        }

        /* 编辑模式下的视觉提示 */
        .edit-mode .brand-title {
            cursor: pointer;
            position: relative;
        }

        .edit-mode .brand-title::after {
            content: '✏️';
            position: absolute;
            top: -5px;
            right: -20px;
            font-size: 12px;
        }

        .edit-mode .join-button {
            cursor: pointer;
            position: relative;
        }

        .edit-mode .join-button::after {
            content: '✏️';
            position: absolute;
            top: -5px;
            right: -15px;
            font-size: 10px;
        }

        /* 会员样式编辑模态框 */
        .member-style-edit-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .member-style-edit-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .member-style-edit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .member-style-edit-header h3 {
            margin: 0;
            color: #333;
        }
        
        .member-style-edit-body {
            padding: 20px;
        }
        
        .style-setting-group {
            margin-bottom: 20px;
        }
        
        .style-setting-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .style-setting-group input[type="range"] {
            width: 70%;
            margin-right: 10px;
        }
        
        .style-setting-group span {
            color: #666;
            font-size: 14px;
        }
        
        .member-style-preview {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .member-style-preview h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .preview-container {
            background: white;
            padding: 15px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .member-style-edit-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 20px;
            border-top: 1px solid #eee;
        }
        
        .member-style-edit-footer button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .reset-btn {
            background: #6c757d;
            color: white;
        }
        
        .save-btn {
            background: #007bff;
            color: white;
        }
        
        .cancel-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .close-btn:hover {
            color: #333;
        }
        
        /* 移动端适配 */
        @media (max-width: 768px) {
            .edit-panel {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
            }
            
            .modal-content {
                width: 95%;
                margin: 20px;
            }
        }

        /* 兴趣图片编辑模态框样式 */
        .interest-images-edit-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .interest-images-edit-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .interest-images-edit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #eee;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px 16px 0 0;
        }
        
        .interest-images-edit-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .interest-images-edit-body {
            padding: 24px;
        }
        
        .interest-images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .interest-image-slot {
            border: 2px dashed #ddd;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .interest-image-slot:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .interest-slot-header h4 {
            margin: 0 0 12px 0;
            font-size: 14px;
            color: #333;
            font-weight: 600;
        }
        
        .interest-image-preview {
            width: 100%;
            height: 120px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            background: #f5f5f5;
            margin-bottom: 12px;
        }
        
        .upload-placeholder {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: #999;
        }
        
        .upload-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .upload-text {
            font-size: 12px;
        }
        
        .remove-image-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .remove-image-btn:hover {
            background: rgba(255, 0, 0, 1);
            transform: scale(1.1);
        }
        
        .interest-slot-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .interest-slot-actions button {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            color: #666;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .upload-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .camera-btn:hover {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }
        
        .interest-edit-tips {
            background: #f8f9ff;
            border: 1px solid #e6e8ff;
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
        }
        
        .interest-edit-tips p {
            margin: 0 0 8px 0;
            font-weight: 600;
            color: #667eea;
        }
        
        .interest-edit-tips ul {
            margin: 0;
            padding-left: 20px;
            color: #666;
        }
        
        .interest-edit-tips li {
            margin-bottom: 4px;
            font-size: 13px;
        }
        
        .interest-images-edit-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 20px 24px;
            border-top: 1px solid #eee;
            background: #f8f9fa;
            border-radius: 0 0 16px 16px;
        }
        
        .interest-images-edit-footer button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .reset-btn {
            background: #6c757d;
            color: white;
        }
        
        .reset-btn:hover {
            background: #5a6268;
        }
        
        .save-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .save-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .cancel-btn {
            background: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
        }
        
        .cancel-btn:hover {
            background: #e9ecef;
        }
        
        /* 移动端适配 */
        @media (max-width: 768px) {
            .interest-images-edit-modal {
                padding: 10px;
            }
            
            .interest-images-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .interest-images-edit-content {
                max-height: 95vh;
            }
            
            .interest-images-edit-header,
            .interest-images-edit-body,
            .interest-images-edit-footer {
                padding: 16px;
            }
        }

        /* 组件样式 */

        .search-section {
            padding: 0 4px;
            margin-top: 25px;
            margin-bottom: 16px;
        }

        .component-search-input {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 10px 16px;
            border: 2px solid var(--border-color);
            border-radius: 24px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 2px 12px rgba(255, 107, 157, 0.15);
        }

        .component-hero-banner {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 16px;
            padding: 20px 16px;
            margin-bottom: 16px;
            color: white;
            text-align: center;
            box-shadow: 0 4px 12px rgba(255, 107, 157, 0.2);
        }

        .hero-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 6px;
            line-height: 1.3;
        }

        .hero-subtitle {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 14px;
            line-height: 1.4;
        }

        .hero-button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .hero-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .banner-section {
            padding: 0 4px;
            margin-bottom: 16px;
        }

        .component-banner-carousel {
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        }

        .component-banner-carousel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            pointer-events: none;
        }

        .component-banner-carousel .banner-content {
            z-index: 1;
            text-align: center;
        }

        .component-banner-carousel .banner-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 0 2px 12px rgba(0, 0, 0, 0.3);
        }

        .component-banner-carousel .banner-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 16px;
            text-shadow: 0 1px 8px rgba(0, 0, 0, 0.2);
        }

        .component-banner-carousel .banner-button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .component-banner-carousel .banner-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        /* 轮播指示器样式 */
        .carousel-indicators {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 15px;
            background: transparent;
            margin-top: 10px;
        }

        .indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            outline: none;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
        }

        .indicator.active {
            width: 24px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .indicator:hover:not(.active) {
            background: rgba(255, 255, 255, 0.6);
            transform: scale(1.2);
        }



        .member-name {
            font-size: 11px;
            color: var(--text-primary);
            text-align: center;
            width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }



        .info-banner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            padding: 8px 16px;
            margin-bottom: 16px;
            box-shadow: 0 1px 8px rgba(0, 0, 0, 0.05);
        }

        .info-content {
            flex: 1;
        }

        .info-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .info-subtitle {
            font-size: 10px;
            color: var(--text-secondary);
        }

        .info-actions {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .chip {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 500;
        }

        .chip-info {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6e15ff 0%, #8735fd 50%, #9e2cf8 100%);
            color: white;
            padding: 4px 12px;
            border: none;
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
        }

        .events-section {
            margin-bottom: 16px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .section-more {
            font-size: 12px;
            background: linear-gradient(135deg, #6e15ff 0%, #8735fd 50%, #9e2cf8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            cursor: pointer;
        }

        .component-event-card {
            background: var(--bg-primary);
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 16px;
            overflow: hidden;
            width: 100%;
            aspect-ratio: 4/3; /* 使用aspect-ratio确保4:3比例 */
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .event-cover {
            width: 100%;
            height: 70%; /* 增大封面区域到70%，更突出活动封面 */
            background: linear-gradient(45deg, #f3f4f6, #e5e7eb);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 14px;
            position: relative;
        }

        .event-cover::after {
            content: '活动封面';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .event-content {
            flex: 1; /* 内容区域占用剩余30%空间 */
            padding: 12px 16px; /* 减少上下内边距以适应更小的内容区域 */
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .event-title {
            font-size: 15px; /* 稍微减小标题字体以适应更小的内容区域 */
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px; /* 减少底部间距 */
        }

        .event-meta {
            font-size: 11px; /* 稍微减小字体 */
            color: var(--text-secondary);
            margin-bottom: 6px; /* 减少底部间距 */
        }

        .event-location {
            font-size: 11px; /* 稍微减小字体 */
            color: var(--text-secondary);
            margin-bottom: 8px; /* 减少底部间距 */
        }

        .event-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .event-capacity {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .event-register-btn {
            background: linear-gradient(135deg, #6e15ff 0%, #8735fd 50%, #9e2cf8 100%);
            color: white;
            border: none;
            padding: 6px 16px;
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
        }

        /* 响应式设计 */
        @media (max-width: 414px) {
            .container-page {
                padding: 12px;
                padding-top: 80px; /* 手机端减少顶部空间 */
            }
            
            .search-section {
                margin-top: 10px; /* 手机端进一步减少搜索栏的上边距 */
            }
            
            .hero-title {
                font-size: 16px;
            }
            
            .hero-subtitle {
                font-size: 12px;
            }
        }

        @media (max-width: 320px) {
            .container-page {
                padding: 8px;
                padding-top: 70px; /* 小屏幕设备进一步减少顶部空间 */
            }
            
            .search-section {
                margin-top: 8px; /* 小屏幕设备进一步减少搜索栏上边距 */
            }
        }

        /* 加载动画 */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
            color: var(--text-secondary);
        }

        /* 隐藏元素 */
        .hidden {
            display: none !important;
        }
        
        /* 推荐活动编辑相关样式 */
        .activity-edit-container {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .activities-edit-grid {
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .activity-edit-item {
            border: 2px solid #e8f4fd;
            border-radius: 16px;
            padding: 20px;
            background: linear-gradient(135deg, #f8fbff 0%, #f0f8ff 100%);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .activity-edit-item:hover {
            border-color: #4facfe;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.15);
        }
        
        .activity-edit-item[data-index="0"]::before { content: "1"; }
        .activity-edit-item[data-index="1"]::before { content: "2"; }
        .activity-edit-item[data-index="2"]::before { content: "3"; }
        
        .activity-edit-item::before {
            position: absolute;
            top: -10px;
            left: 20px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .activity-cover-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .activity-cover-preview {
            width: 200px;
            height: 150px;
            border: 2px dashed #d0d0d0;
            border-radius: 12px;
            background: #fafafa;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .activity-cover-preview:hover {
            border-color: #4facfe;
            background: #f8fbff;
        }
        
        .activity-upload-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .activity-content-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
        
        .form-group label::before {
            content: "•";
            color: #4facfe;
            font-weight: bold;
            margin-right: 6px;
        }
        
        .form-input, .form-textarea {
            padding: 12px 16px;
            border: 2px solid #e8f0fe;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }
        
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
            background: #fafbff;
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
            line-height: 1.5;
        }
        
        .form-group:nth-child(2) {
            grid-column: 1 / -1;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .activity-content-section {
                grid-template-columns: 1fr;
            }
            
            .activity-cover-preview {
                width: 160px;
                height: 120px;
            }
            
            .modal-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .save-btn, .reset-btn, .cancel-btn {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>


    <!-- 模拟小程序顶部导航栏 -->
    <div class="miniprogram-navbar">
        <div class="navbar-left">
            <div class="navbar-brand-unified" id="topPinyuClubTitle">PINYU<br>CLUB</div>
        </div>
        <div class="navbar-center">
            <a href="#" class="nav-item nav-item-multiline active" onclick="handleNavClick('home')">
                <span class="nav-line">首</span>
                <span class="nav-line">页</span>
            </a>
            <a href="#" class="nav-item nav-item-multiline" onclick="handleNavClick('my')">
                <span class="nav-line">我的</span>
                <span class="nav-line">主页</span>
            </a>
            <a href="#" class="nav-item nav-item-multiline" onclick="handleNavClick('match')">
                <span class="nav-line">同频</span>
                <span class="nav-line">相遇</span>
            </a>
            <a href="#" class="nav-item nav-item-multiline" onclick="handleNavClick('test')">
                <span class="nav-line">测</span>
                <span class="nav-line">测</span>
            </a>
            <a href="#" class="nav-item nav-item-multiline" onclick="handleNavClick('activity')">
                <span class="nav-line">活</span>
                <span class="nav-line">动</span>
            </a>
            <a href="#" class="nav-item nav-item-multiline" onclick="handleNavClick('community')">
                <span class="nav-line">社</span>
                <span class="nav-line">区</span>
            </a>
            <a href="#" class="nav-item nav-item-multiline" onclick="handleNavClick('member')">
                <span class="nav-line">会员</span>
                <span class="nav-line">中心</span>
            </a>
        </div>
        <div class="navbar-right">
            <a href="#" class="nav-item nav-item-multiline" onclick="handleMessageClick()" style="position: relative;">
                <span class="nav-line">消</span>
                <span class="nav-line">息</span>
                <span class="message-badge">126</span>
            </a>
        </div>
    </div>

    <div class="container-page theme-default">

        <!-- 顶部搜索栏 -->
        <div class="search-section">
            <div class="component-search-input">
                <input type="text" class="search-input" placeholder="Search for jobs" id="searchInput">
            </div>
        </div>

        <!-- 立即加入板块 -->
        <div class="join-section">
            <div class="join-card">
                <div class="join-content">
                    <div class="join-title">同频终相逢 共振即永恒</div>
                    <div class="join-subtitle">AI驱动的高质量线下活动与专属社交</div>
                </div>
                <button class="join-button" id="joinButton" onclick="handleJoinClick()">立即加入</button>
            </div>
        </div>

        <!-- 轮播海报栏 -->
        <div class="carousel-section">
            <div class="carousel-container">
                <div class="carousel-slide active">
                    <div class="slide-content">
                        <div class="brand-info">
                            <div class="brand-title" id="pinyuClubTitle">PINYU CLUB</div>
                            <div class="brand-subtitle">高端社交俱乐部小程序</div>
                            <div class="brand-description">专为25-65岁高净值人群打造的高质量社交平台</div>
                            <div class="brand-slogan">同频终相逢，共振即永恒</div>
                        </div>
                        <div class="phone-mockup">
                            <div class="phone-screen">
                                <div class="match-card">
                                    <div class="match-avatar">👤</div>
                                    <div class="match-info">
                                        <div class="match-name">Sarah Chen</div>
                                        <div class="match-details">投资顾问 · 32岁</div>
                                        <div class="match-interests">艺术收藏 · 红酒品鉴</div>
                                    </div>
                                    <div class="match-score">95%匹配</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="carousel-slide">
                    <div class="slide-bg" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                </div>
                <div class="carousel-slide">
                    <div class="slide-bg" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
                </div>
                <div class="carousel-slide">
                    <div class="slide-bg" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></div>
                </div>
                <div class="carousel-slide">
                    <div class="slide-bg" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></div>
                </div>
            </div>
            <div class="carousel-indicators">
                <div class="indicator active" onclick="goToSlide(0)"></div>
                <div class="indicator" onclick="goToSlide(1)"></div>
                <div class="indicator" onclick="goToSlide(2)"></div>
                <div class="indicator" onclick="goToSlide(3)"></div>
                <div class="indicator" onclick="goToSlide(4)"></div>
            </div>
        </div>

        <!-- 会员头像轮播区域 -->
        <div class="members-carousel-section">
            <div class="members-carousel-container">
                <div class="members-carousel-track" id="membersCarouselTrack">
                    <!-- 会员头像将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>

        <!-- 兴趣发现轮播海报区 -->
        <div class="interest-carousel-section">
            <div class="interest-carousel-container">
                <div class="interest-carousel-slide active">
                    <div class="interest-slide-content">
                        <div class="interest-card-title">打开自己的兴趣宝藏</div>
                        <div class="interest-card-subtitle">测测自己</div>
                    </div>
                </div>
                <div class="interest-carousel-slide">
                    <div class="interest-slide-bg" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                </div>
                <div class="interest-carousel-slide">
                    <div class="interest-slide-bg" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
                </div>
                <div class="interest-carousel-slide">
                    <div class="interest-slide-bg" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></div>
                </div>
            </div>
            <div class="interest-carousel-indicators">
                <div class="interest-indicator active" onclick="goToInterestSlide(0)"></div>
                <div class="interest-indicator" onclick="goToInterestSlide(1)"></div>
                <div class="interest-indicator" onclick="goToInterestSlide(2)"></div>
                <div class="interest-indicator" onclick="goToInterestSlide(3)"></div>
            </div>
        </div>

        <!-- 信息条 -->
        <div class="info-banner">
            <div class="info-content">
                <div class="info-title">线下同城聚会</div>
                <div class="info-subtitle">周末见</div>
            </div>
            <div class="info-actions">
                <button class="btn-secondary" onclick="handleActivities()">了解更多</button>
            </div>
        </div>

        <!-- 推荐活动 -->
        <div class="events-section">
            <div class="section-header">
                <div class="section-title">推荐活动</div>
                <div class="section-more" onclick="handleActivities()">查看全部</div>
            </div>
            <div class="events-list" id="eventsList">
                <!-- 活动列表将通过JavaScript动态生成 -->
            </div>
        </div>

        <!-- 快速操作 -->
    </div>

    <!-- 模拟小程序底部TabBar -->
    <div class="miniprogram-tabbar">
        <div class="tab-item active" onclick="handleTabClick('home')">
            <div class="tab-icon">
                <!-- 简洁的五角星图标（带笑脸） -->
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- 五角星外框 -->
                    <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    <!-- 笑脸眼睛 -->
                    <circle cx="10" cy="10.5" r="0.8" fill="currentColor"/>
                    <circle cx="14" cy="10.5" r="0.8" fill="currentColor"/>
                    <!-- 笑脸嘴巴 -->
                    <path d="M10 13.5C10 13.5 11 14.5 12 14.5C13 14.5 14 13.5 14 13.5" stroke="currentColor" stroke-width="1" stroke-linecap="round"/>
                </svg>
            </div>
            <div class="tab-text">活动</div>
        </div>
        <div class="tab-item" onclick="handleTabClick('match')">
            <div class="tab-icon">
                <!-- 简洁的双人图标 -->
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- 左边的人 -->
                    <circle cx="9" cy="7" r="3" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    <path d="M3 21C3 17.134 5.686 14 9 14C12.314 14 15 17.134 15 21" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    <!-- 右边的人 -->
                    <circle cx="15" cy="7" r="3" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    <path d="M9 21C9 17.134 11.686 14 15 14C18.314 14 21 17.134 21 21" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
            </div>
            <div class="tab-text">相遇</div>
        </div>
        <div class="tab-item" onclick="handleTabClick('publish')">
            <div class="tab-icon publish-icon">
                <!-- 圆形底框徽标 -->
                <div class="publish-badge">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 13H13V19H11V13H5V11H11V5H13V11H19V13Z" fill="white"/>
                    </svg>
                </div>
            </div>
            <div class="tab-text">发布</div>
        </div>
        <div class="tab-item" onclick="handleTabClick('message')">
            <div class="tab-icon">
                <!-- 截图3：聊天气泡图标（边框样式） -->
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                    <circle cx="8" cy="10" r="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    <circle cx="12" cy="10" r="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    <circle cx="16" cy="10" r="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
            </div>
            <div class="tab-text">消息</div>
        </div>
        <div class="tab-item" onclick="handleTabClick('profile')">
            <div class="tab-icon">
                <!-- 截图4：用户头像图标（边框样式） -->
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                    <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                </svg>
            </div>
            <div class="tab-text">我的</div>
        </div>
    </div>

    <script>
        // 页面加载后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面加载完成');
        });
        
        // 额外的页面完全加载检查
        window.addEventListener('load', function() {
            // 页面加载完成
            console.log('页面加载完成');
        });
        
        // 基础JavaScript - 移除调试信息
        
        // 模拟小程序数据和API
        const mockData = {
            members: [
                { id: 1, name: '小明', avatarUrl: '' },
                { id: 2, name: '小红', avatarUrl: '' },
                { id: 3, name: '小李', avatarUrl: '' },
                { id: 4, name: '小王', avatarUrl: '' },
                { id: 5, name: '小张', avatarUrl: '' }
            ],
            events: [
                {
                    id: 1,
                    title: '周末户外徒步',
                    meta: '本周六 14:00',
                    place: '香山公园',
                    city: '北京',
                    capacity: 20,
                    registered: 15,
                    registeredByMe: false
                },
                {
                    id: 2,
                    title: '咖啡品鉴会',
                    meta: '本周日 15:00',
                    place: '星巴克旗舰店',
                    city: '上海',
                    capacity: 12,
                    registered: 12,
                    registeredByMe: true
                }
            ]
        };

        // 立即加入功能
        function handleJoinClick() {
            alert('欢迎加入PINYU CLUB！\n\n这是一个高端社交俱乐部小程序的演示版本。\n\n如需完整体验，请在微信开发者工具中打开此项目。');
        }

        // 轮播功能
        let currentSlide = 0;
        let slides, indicators;

        function initCarousel() {
            slides = document.querySelectorAll('.carousel-slide');
            indicators = document.querySelectorAll('.indicator');
            
            // 从localStorage加载轮播图片
            loadCarouselImages();
            
            // 从localStorage加载轮播文字
            loadCarouselTexts();
        }

        function loadCarouselImages() {
            try {
                const savedImages = localStorage.getItem('carouselImages');
                if (savedImages) {
                    const carouselImages = JSON.parse(savedImages);
                    
                    // 如果是第一个轮播，保持原有内容结构，只更新背景
                    if (carouselImages[0] && slides[0]) {
                        const firstSlide = slides[0];
                        const slideContent = firstSlide.querySelector('.slide-content');
                        if (slideContent) {
                            slideContent.style.backgroundImage = `url(${carouselImages[0]})`;
                            slideContent.style.backgroundSize = 'cover';
                            slideContent.style.backgroundPosition = 'center';
                        }
                    }
                    
                    // 其他轮播直接设置背景图片
                    for (let i = 1; i < carouselImages.length && i < slides.length; i++) {
                        if (carouselImages[i] && slides[i]) {
                            const slideBg = slides[i].querySelector('.slide-bg');
                            if (slideBg) {
                                slideBg.style.backgroundImage = `url(${carouselImages[i]})`;
                                slideBg.style.backgroundSize = 'cover';
                                slideBg.style.backgroundPosition = 'center';
                            }
                        }
                    }
                }
            } catch (e) {
                console.error('加载轮播图片失败:', e);
            }
        }

        function loadCarouselTexts() {
            try {
                const savedTexts = localStorage.getItem('carouselTexts');
                if (savedTexts) {
                    const carouselTexts = JSON.parse(savedTexts);
                    if (carouselTexts[0] && slides[0]) {
                        const firstSlide = slides[0];
                        
                        // 更新品牌信息文字
                        const brandTitle = firstSlide.querySelector('.brand-title');
                        const brandSubtitle = firstSlide.querySelector('.brand-subtitle');
                        const brandDescription = firstSlide.querySelector('.brand-description');
                        const brandSlogan = firstSlide.querySelector('.brand-slogan');
                        
                        if (brandTitle) brandTitle.textContent = carouselTexts[0].title || 'PINYU CLUB';
                        if (brandSubtitle) brandSubtitle.textContent = carouselTexts[0].subtitle || '高端社交俱乐部小程序';
                        if (brandDescription) brandDescription.textContent = carouselTexts[0].description || '专为25-65岁高净值人群打造的高质量社交平台';
                        if (brandSlogan) brandSlogan.textContent = carouselTexts[0].slogan || '同频终相逢，共振即永恒';
                        
                        // 更新字体颜色
                        const fontColor = carouselTexts[0].fontColor || '#ffffff';
                        [brandTitle, brandSubtitle, brandDescription, brandSlogan].forEach(element => {
                            if (element) element.style.color = fontColor;
                        });
                    }
                }
            } catch (e) {
                console.error('加载轮播文字失败:', e);
            }
        }

        function goToSlide(index) {
            if (slides && indicators) {
                // 移除当前活动状态
                slides[currentSlide].classList.remove('active');
                indicators[currentSlide].classList.remove('active');
                
                // 设置新的活动状态
                currentSlide = index;
                slides[currentSlide].classList.add('active');
                indicators[currentSlide].classList.add('active');
            }
        }

        // 自动轮播
        function startAutoCarousel() {
            setInterval(() => {
                if (slides && slides.length > 0) {
                    const nextSlide = (currentSlide + 1) % slides.length;
                    goToSlide(nextSlide);
                }
            }, 5000);
        }

        // 兴趣轮播功能
        let currentInterestSlide = 0;
        let interestSlides, interestIndicators;

        function initInterestCarousel() {
            interestSlides = document.querySelectorAll('.interest-carousel-slide');
            interestIndicators = document.querySelectorAll('.interest-indicator');
        }

        function goToInterestSlide(index) {
            if (interestSlides && interestIndicators) {
                // 移除当前活动状态
                interestSlides[currentInterestSlide].classList.remove('active');
                interestIndicators[currentInterestSlide].classList.remove('active');
                
                // 设置新的活动状态
                currentInterestSlide = index;
                interestSlides[currentInterestSlide].classList.add('active');
                interestIndicators[currentInterestSlide].classList.add('active');
            }
        }

        // 启动兴趣轮播自动播放
        function startAutoInterestCarousel() {
            setInterval(() => {
                if (interestSlides && interestSlides.length > 0) {
                    const nextSlide = (currentInterestSlide + 1) % interestSlides.length;
                    goToInterestSlide(nextSlide);
                }
            }, 4000);
        }
        function initMembersCarousel() {
            const membersData = [
                {
                    id: 'ryan',
                    name: 'Ryan',
                    avatar: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="50" cy="35" r="15" fill="#8B4513"/>
                        <circle cx="50" cy="70" r="25" fill="#4169E1"/>
                        <circle cx="42" cy="32" r="2" fill="#000"/>
                        <circle cx="58" cy="32" r="2" fill="#000"/>
                        <path d="M45 40 Q50 45 55 40" stroke="#000" stroke-width="1" fill="none"/>
                    </svg>`
                },
                {
                    id: 'yuki',
                    name: 'Yuki',
                    avatar: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="50" cy="35" r="15" fill="#DDA0DD"/>
                        <circle cx="50" cy="70" r="25" fill="#FF69B4"/>
                        <circle cx="42" cy="32" r="2" fill="#000"/>
                        <circle cx="58" cy="32" r="2" fill="#000"/>
                        <path d="M45 40 Q50 45 55 40" stroke="#000" stroke-width="1" fill="none"/>
                    </svg>`
                },
                {
                    id: 'victor',
                    name: 'Victor',
                    avatar: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="50" cy="35" r="15" fill="#228B22"/>
                        <circle cx="50" cy="70" r="25" fill="#32CD32"/>
                        <circle cx="42" cy="32" r="2" fill="#000"/>
                        <circle cx="58" cy="32" r="2" fill="#000"/>
                        <path d="M45 40 Q50 45 55 40" stroke="#000" stroke-width="1" fill="none"/>
                    </svg>`
                },
                {
                    id: 'jack',
                    name: 'Jack',
                    avatar: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="50" cy="35" r="15" fill="#FF6347"/>
                        <circle cx="50" cy="70" r="25" fill="#FF4500"/>
                        <circle cx="42" cy="32" r="2" fill="#000"/>
                        <circle cx="58" cy="32" r="2" fill="#000"/>
                        <path d="M45 40 Q50 45 55 40" stroke="#000" stroke-width="1" fill="none"/>
                    </svg>`
                }
            ];
            
            const track = document.getElementById('membersCarouselTrack');
            if (track) {
                // 创建双倍数量的头像以实现无缝循环
                const allMembers = [...membersData, ...membersData];
                
                allMembers.forEach(member => {
                    const avatarElement = document.createElement('div');
                    avatarElement.className = 'member-avatar';
                    avatarElement.innerHTML = member.avatar;
                    avatarElement.title = member.name;
                    
                    // 添加会员名字显示
                    const nameElement = document.createElement('div');
                    nameElement.className = 'member-name';
                    nameElement.textContent = member.name;
                    
                    // 创建包装容器
                    const memberContainer = document.createElement('div');
                    memberContainer.className = 'member-container';
                    memberContainer.appendChild(avatarElement);
                    memberContainer.appendChild(nameElement);
                    
                    track.appendChild(memberContainer);
                });
            }
        }

        // 初始化页面数据
        const pageData = {
            query: '',
            events: mockData.events,
            members: mockData.members,
            unreadCount: 3,
            brandThemeKey: 'default'
        };

        // 模拟wx API
        window.wx = {
            showToast: function(options) {
                alert(options.title);
                if (options.success) options.success();
            },
            navigateTo: function(options) {
                if (options.success) options.success();
            }
        };

        // 模拟小程序页面初始化
        function initializePage() {
            console.log('🚀 开始初始化页面');
            
            // 渲染会员列表
            renderMembers();
            
            // 渲染活动列表
            renderEvents();

            // 绑定搜索事件
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', handleSearchInput);
            }
        }

        // 渲染会员列表 - 已删除会员头像区域，此函数不再需要
        function renderMembers() {
            // 会员头像区域已删除，此函数不再执行任何操作
        }

        // 渲染活动列表
        function renderEvents() {
            const container = document.getElementById('eventsList');
            if (!container) return;
            
            container.innerHTML = '';

            pageData.events.forEach(event => {
                const eventElement = document.createElement('div');
                eventElement.className = 'component-event-card';
                eventElement.innerHTML = `
                    <div class="event-cover">活动封面</div>
                    <div class="event-content">
                        <div class="event-title">${event.title}</div>
                        <div class="event-meta">${event.meta}</div>
                        <div class="event-location">${event.place} · ${event.city}</div>
                        <div class="event-stats">
                            <div class="event-capacity">${event.registered}/${event.capacity}人</div>
                            <button class="event-register-btn" onclick="handleEventRegister(${event.id})">
                                ${event.registeredByMe ? '已报名' : '报名'}
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(eventElement);
            });
        }



        // 事件处理函数
        function handleSearchInput(event) {
            pageData.query = event.target.value;
        }

        function handleJoinNow() {
            wx.showToast({ title: '欢迎加入频遇！', icon: 'success' });
        }

        function handleQuickAction(action) {
            wx.showToast({ title: `${action}功能`, icon: 'success' });
        }

        function handleActivities() {
            // 显示选择弹窗
            const userChoice = confirm('活动功能正在开发中！\n\n点击"确定"查看干净页面预览\n点击"取消"查看开发提示');
            
            if (userChoice) {
                // 用户选择查看干净页面
                window.location.href = 'clean-homepage.html';
            } else {
                // 显示开发中提示
                alert('测试功能正在开发中，敬请期待！');
            }
        }

        function handleMemberTap(memberId) {
            wx.navigateTo({ url: `/pages/profile/index?id=${memberId}` });
        }

        function handleEventRegister(eventId) {
            const event = pageData.events.find(e => e.id === eventId);
            if (event) {
                event.registeredByMe = !event.registeredByMe;
                if (event.registeredByMe) {
                    event.registered++;
                } else {
                    event.registered--;
                }
                renderEvents();
                
                wx.showToast({ 
                    title: event.registeredByMe ? '报名成功' : '取消报名', 
                    icon: 'success' 
                });
            }
        }

        // 导航栏交互函数
        function handleNavClick(navType) {
            // 移除所有导航项的active类
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                item.classList.remove('active-touch');
            });
            
            // 为当前点击的导航项添加active类
            const clickedItem = event.target.closest('.nav-item');
            if (clickedItem) {
                clickedItem.classList.add('active');
                
                // 添加触摸反馈效果
                clickedItem.classList.add('active-touch');
                setTimeout(() => {
                    clickedItem.classList.remove('active-touch');
                }, 150);
            }
            
            // 根据导航类型执行相应操作
            switch(navType) {
                case 'home':
                    console.log('点击了首页 - 保持在当前页面');
                    // 保持在当前页面，不进行跳转
                    break;
                case 'my':
                    console.log('导航到我的主页');
                    window.location.href = 'profile.html';
                    break;
                case 'match':
                    console.log('导航到同频相遇');
                    window.location.href = 'frequency-match.html';
                    break;
                case 'test':
                    console.log('导航到测测');
                    // 跳转到干净主页
                    window.location.href = 'clean-homepage.html';
                    break;
                case 'activity':
                    console.log('导航到活动');
                    // 跳转到活动页面
                    window.location.href = 'activity-page.html';
                    break;
                case 'community':
                    console.log('导航到社区');
                    // 跳转到干净主页
                    window.location.href = 'clean-homepage.html';
                    break;
                case 'member':
                    console.log('导航到会员中心');
                    // 跳转到干净主页
                    window.location.href = 'clean-homepage.html';
                    break;
            }
        }

        // 底部导航处理函数
        function handleTabClick(tabType) {
            // 移除所有tab的active类
            document.querySelectorAll('.tab-item').forEach(item => {
                item.classList.remove('active');
                item.classList.remove('active-touch');
            });
            
            // 为当前点击的tab添加active类
            const clickedTab = event.target.closest('.tab-item');
            if (clickedTab) {
                clickedTab.classList.add('active');
                
                // 添加触摸反馈效果
                clickedTab.classList.add('active-touch');
                setTimeout(() => {
                    clickedTab.classList.remove('active-touch');
                }, 150);
            }
            
            // 根据tab类型执行相应操作
            switch(tabType) {
                case 'home':
                    console.log('点击了活动tab - 保持在当前页面');
                    break;
                case 'match':
                    console.log('点击了相遇tab');
                    window.location.href = 'frequency-match.html';
                    break;
                case 'publish':
                    console.log('点击了发布tab');
                    window.location.href = 'social-home.html';
                    break;
                case 'message':
                    console.log('点击了消息tab');
                    window.location.href = 'messages.html';
                    break;
                case 'profile':
                    console.log('点击了我的tab');
                    window.location.href = 'profile.html';
                    break;
                default:
                    console.log(`${tabType}功能正在开发中`);
            }
        }

        function handleMessageClick() {
            // 添加触摸反馈效果
            const clickedItem = event.target.closest('.nav-item');
            if (clickedItem) {
                clickedItem.classList.add('active-touch');
                setTimeout(() => {
                    clickedItem.classList.remove('active-touch');
                }, 150);
            }
            
            console.log('打开消息页面');
            // 跳转到消息页面
            window.location.href = 'messages.html';
        }



        // 页面加载完成后初始化
        // 运营编辑模式相关变量
        let clickCount = 0;
        let isEditMode = false;
        let editModeTimeout = null;
        
        // 撤回功能相关函数
        function saveOperationToHistory(operationType, data) {
            console.log('💾 保存操作到历史:', operationType, data);
            
            const operation = {
                type: operationType,
                timestamp: Date.now(),
                data: JSON.parse(JSON.stringify(data)), // 深拷贝
                id: Date.now() + '_' + Math.random().toString(36).substr(2, 9)
            };
            
            operationHistory.push(operation);
            
            // 限制历史记录数量
            if (operationHistory.length > MAX_HISTORY) {
                operationHistory.shift();
            }
            
            // 保存到本地存储
            localStorage.setItem('pinyu_operation_history', JSON.stringify(operationHistory));
            updateUndoButton();
            
            console.log('✅ 操作已保存，当前历史记录数量:', operationHistory.length);
        }
        
        function undoLastOperation() {
            if (operationHistory.length === 0) {
                alert('没有可撤回的操作');
                return;
            }
            
            const lastOperation = operationHistory.pop();
            console.log('↶ 撤回操作:', lastOperation);
            
            try {
                switch (lastOperation.type) {
                    case 'carousel_images':
                        // 撤回轮播图片修改
                        if (lastOperation.data.images) {
                            localStorage.setItem('pinyu_carousel_images', JSON.stringify(lastOperation.data.images));
                            loadSavedCarouselImages();
                        }
                        break;
                        
                    case 'interest_images':
                        // 撤回兴趣图片修改
                        if (lastOperation.data.images) {
                            localStorage.setItem('pinyu_interest_images', JSON.stringify(lastOperation.data.images));
                            loadSavedInterestImages();
                        }
                        break;
                        
                    case 'join_card':
                        // 撤回立即加入卡片修改
                        if (lastOperation.data.title) {
                            const titleElement = document.querySelector('.join-card h3');
                            if (titleElement) titleElement.textContent = lastOperation.data.title;
                        }
                        if (lastOperation.data.subtitle) {
                            const subtitleElement = document.querySelector('.join-card p');
                            if (subtitleElement) subtitleElement.textContent = lastOperation.data.subtitle;
                        }
                        break;
                        
                    case 'activity_cards':
                        // 撤回活动卡片修改
                        if (lastOperation.data.cards) {
                            lastOperation.data.cards.forEach((cardData, index) => {
                                const card = document.querySelectorAll('.activity-card')[index];
                                if (card) {
                                    const img = card.querySelector('img');
                                    const title = card.querySelector('h4');
                                    const desc = card.querySelector('p');
                                    
                                    if (img && cardData.image) img.src = cardData.image;
                                    if (title && cardData.title) title.textContent = cardData.title;
                                    if (desc && cardData.description) desc.textContent = cardData.description;
                                }
                            });
                        }
                        break;
                        
                    default:
                        console.warn('未知的操作类型:', lastOperation.type);
                }
                
                // 更新本地存储
                localStorage.setItem('pinyu_operation_history', JSON.stringify(operationHistory));
                updateUndoButton();
                
                alert(`✅ 已撤回操作: ${lastOperation.type}\n时间: ${new Date(lastOperation.timestamp).toLocaleString()}`);
                
            } catch (error) {
                console.error('撤回操作失败:', error);
                alert('撤回操作失败，请重试');
                // 如果撤回失败，将操作重新加入历史
                operationHistory.push(lastOperation);
                localStorage.setItem('pinyu_operation_history', JSON.stringify(operationHistory));
                updateUndoButton();
            }
        }
        
        function updateUndoButton() {
            const undoBtn = document.getElementById('undoBtn');
            if (undoBtn) {
                undoBtn.disabled = operationHistory.length === 0;
                undoBtn.title = operationHistory.length > 0 
                    ? `撤回上次操作 (${operationHistory.length}个历史记录)` 
                    : '没有可撤回的操作';
            }
        }
        
        function createFullBackup() {
            const backup = {
                timestamp: Date.now(),
                carousel_images: JSON.parse(localStorage.getItem('pinyu_carousel_images') || '[]'),
                interest_images: JSON.parse(localStorage.getItem('pinyu_interest_images') || '[]'),
                join_card: {
                    title: document.querySelector('.join-card h3')?.textContent || '',
                    subtitle: document.querySelector('.join-card p')?.textContent || ''
                },
                activity_cards: Array.from(document.querySelectorAll('.activity-card')).map(card => ({
                    image: card.querySelector('img')?.src || '',
                    title: card.querySelector('h4')?.textContent || '',
                    description: card.querySelector('p')?.textContent || ''
                }))
            };
            
            localStorage.setItem('pinyu_full_backup', JSON.stringify(backup));
            alert(`✅ 完整备份已创建\n时间: ${new Date(backup.timestamp).toLocaleString()}`);
        }
        
        function showBackupHistory() {
            const historyHtml = operationHistory.map((op, index) => 
                `<div style="padding: 8px; border-bottom: 1px solid #eee;">
                    <strong>${op.type}</strong> - ${new Date(op.timestamp).toLocaleString()}
                </div>`
            ).join('');
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
                background: rgba(0,0,0,0.5); z-index: 10000; 
                display: flex; align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 10px; max-width: 500px; max-height: 70vh; overflow-y: auto;">
                    <h3>操作历史 (${operationHistory.length}/${MAX_HISTORY})</h3>
                    <div>${historyHtml || '<p>暂无操作历史</p>'}</div>
                    <button onclick="this.closest('div').parentElement.remove()" style="margin-top: 15px; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">关闭</button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
         
         // 恢复操作历史
         function loadOperationHistory() {
             try {
                 const savedHistory = localStorage.getItem('pinyu_operation_history');
                 if (savedHistory) {
                     operationHistory = JSON.parse(savedHistory);
                     console.log('📚 已恢复操作历史:', operationHistory.length, '条记录');
                 }
             } catch (error) {
                 console.error('恢复操作历史失败:', error);
                 operationHistory = [];
             }
         }
         
         // 撤回功能相关变量
         let backupData = {};
         let operationHistory = [];
         const MAX_HISTORY = 10;

        // 点击PINYU CLUB标题触发编辑模式
        function initEditMode() {
            console.log('🔧 [DEBUG] 开始初始化编辑模式...');
            console.log('🔧 [DEBUG] 当前页面URL:', window.location.href);
            console.log('🔧 [DEBUG] 当前页面标题:', document.title);
            
            // 等待DOM完全加载
            setTimeout(() => {
                console.log('🔧 [DEBUG] DOM加载完成，开始查找元素...');
                
                // 查找顶部导航栏的PINYU CLUB标题（正确的触发位置）
                const topPinyuTitle = document.getElementById('topPinyuClubTitle');
                console.log('📍 [DEBUG] 查找顶部PINYU CLUB标题元素:', topPinyuTitle);
                
                if (topPinyuTitle) {
                    console.log('✅ [DEBUG] 成功找到顶部PINYU CLUB标题元素');
                    console.log('📍 [DEBUG] 元素位置:', topPinyuTitle.getBoundingClientRect());
                    console.log('📍 [DEBUG] 元素可见性:', topPinyuTitle.offsetWidth > 0 && topPinyuTitle.offsetHeight > 0);
                    console.log('📍 [DEBUG] 元素样式:', window.getComputedStyle(topPinyuTitle));
                    
                    // 强制设置样式确保可点击
                    topPinyuTitle.style.cursor = 'pointer';
                    topPinyuTitle.style.pointerEvents = 'auto';
                    topPinyuTitle.style.zIndex = '1000';
                    topPinyuTitle.style.position = 'relative';
                    // 移除调试背景色
                    topPinyuTitle.title = '连续点击5次激活编辑模式';
                    
                    console.log('🎨 [DEBUG] 已设置调试样式和提示');
                    
                    // 移除可能存在的旧事件监听器
                    topPinyuTitle.removeEventListener('click', handleTitleClick);
                    
                    // 添加新的事件监听器
                    topPinyuTitle.addEventListener('click', handleTitleClick, true);
                    console.log('✅ [DEBUG] 成功绑定点击事件到顶部PINYU CLUB标题');
                    
                    // 测试点击事件
                    console.log('🧪 [DEBUG] 添加测试事件监听器...');
                    topPinyuTitle.addEventListener('mousedown', function(e) {
                        console.log('🖱️ [DEBUG] 鼠标按下事件触发', e);
                    });
                    
                    topPinyuTitle.addEventListener('mouseup', function(e) {
                        console.log('🖱️ [DEBUG] 鼠标抬起事件触发', e);
                    });
                    
                    // 添加一个简单的测试点击
                    console.log('🧪 [DEBUG] 添加简单测试点击事件...');
                    topPinyuTitle.onclick = function(e) {
                        console.log('🖱️ [DEBUG] onclick事件触发!', e);
                        console.log('🖱️ [DEBUG] 事件目标:', e.target);
                        console.log('🖱️ [DEBUG] 事件类型:', e.type);
                    };
                    
                } else {
                    console.error('❌ [DEBUG] 未找到ID为topPinyuClubTitle的元素');
                    console.log('🔍 [DEBUG] 页面中所有带ID的元素:');
                    const allElementsWithId = document.querySelectorAll('[id]');
                    allElementsWithId.forEach(el => {
                        console.log('  - ID:', el.id, '元素:', el.tagName, '文本:', el.textContent?.substring(0, 50));
                    });
                    
                    console.log('🔍 [DEBUG] 搜索包含"PINYU"的元素:');
                    const pinyuElements = document.querySelectorAll('*');
                    pinyuElements.forEach(el => {
                        if (el.textContent && el.textContent.includes('PINYU')) {
                            console.log('  - 找到PINYU元素:', el.tagName, 'ID:', el.id, 'Class:', el.className, '文本:', el.textContent?.substring(0, 50));
                        }
                    });
                }
                
                // 移除轮播区域PINYU CLUB的调试背景
                const carouselPinyuTitle = document.getElementById('pinyuClubTitle');
                if (carouselPinyuTitle) {
                    carouselPinyuTitle.style.backgroundColor = 'transparent';
                    console.log('🧹 [DEBUG] 已移除轮播区域PINYU CLUB的调试背景');
                }
                
            }, 1000);
        }
        
        // 处理标题点击的函数
        function handleTitleClick(event) {
            console.log('🖱️ [DEBUG] handleTitleClick函数被调用!');
            console.log('🖱️ [DEBUG] 事件对象:', event);
            console.log('🖱️ [DEBUG] 事件目标:', event.target);
            console.log('🖱️ [DEBUG] 当前点击计数:', clickCount);
            
            event.preventDefault();
            event.stopPropagation();
            
            clickCount++;
            console.log(`🖱️ [DEBUG] PINYU CLUB被点击，当前点击次数: ${clickCount}/5`);
            console.log('🖱️ [DEBUG] 点击事件详情:', event);
            
            // 重置计数器的超时
            if (editModeTimeout) {
                clearTimeout(editModeTimeout);
                console.log('🖱️ [DEBUG] 清除了之前的超时计时器');
            }
            
            // 3秒内没有点击则重置计数
            editModeTimeout = setTimeout(() => {
                console.log('⏰ [DEBUG] 3秒超时，重置点击计数');
                clickCount = 0;
            }, 3000);
            
            if (clickCount === 5) {
                console.log('🎉 [DEBUG] 达到5次点击，激活编辑模式！');
                toggleEditMode();
                clickCount = 0;
            }
        }

        // 切换编辑模式
        function toggleEditMode() {
            isEditMode = !isEditMode;
            
            if (isEditMode) {
                showEditPanel();
                document.body.classList.add('edit-mode');
                alert('🎉 运营编辑模式已激活！\n\n您现在可以编辑页面内容了。');
            } else {
                hideEditPanel();
                document.body.classList.remove('edit-mode');
                alert('编辑模式已关闭');
            }
        }

        // 显示编辑面板
        function showEditPanel() {
            // 创建编辑面板
            const editPanel = document.createElement('div');
            editPanel.id = 'editPanel';
            editPanel.className = 'edit-panel';
            editPanel.innerHTML = `
                <div class="edit-panel-header">
                    <h3>🛠️ 运营编辑面板</h3>
                    <div class="header-actions">
                        <button onclick="undoLastOperation()" class="undo-btn" id="undoBtn" disabled>↶ 撤回</button>
                        <button onclick="toggleEditMode()" class="close-btn">×</button>
                    </div>
                </div>
                <div class="edit-panel-content">
                    <div class="edit-section">
                        <h4>📝 文字编辑</h4>
                        <button onclick="editJoinCard()" class="edit-btn">编辑立即加入卡片</button>
                        <button onclick="editActivityCards()" class="edit-btn">编辑推荐活动</button>
                    </div>
                    <div class="edit-section">
                        <h4>🖼️ 图片管理</h4>
                        <button onclick="editCarouselImages()" class="edit-btn">编辑轮播海报</button>
                        <button onclick="editInterestImages()" class="edit-btn">编辑兴趣宝藏图片</button>
                    </div>
                    <div class="edit-section">
                        <h4>👥 会员管理</h4>
                        <button onclick="editMemberStyle()" class="edit-btn">编辑会员轮播样式</button>
                    </div>
                    <div class="edit-section">
                        <h4>🔧 系统操作</h4>
                        <button onclick="createFullBackup()" class="backup-btn">创建完整备份</button>
                        <button onclick="showBackupHistory()" class="history-btn">查看操作历史</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(editPanel);
            updateUndoButton();
        }

        // 隐藏编辑面板
        function hideEditPanel() {
            const editPanel = document.getElementById('editPanel');
            if (editPanel) {
                editPanel.remove();
            }
        }

        // 编辑立即加入卡片
        function editJoinCard() {
            const joinButton = document.getElementById('joinButton');
            const joinTitle = document.querySelector('.join-title');
            const joinSubtitle = document.querySelector('.join-subtitle');
            
            if (joinButton) {
                const currentButtonText = joinButton.textContent;
                const currentTitle = joinTitle ? joinTitle.textContent : '';
                const currentSubtitle = joinSubtitle ? joinSubtitle.textContent : '';
                
                // 创建编辑对话框
                const editModal = document.createElement('div');
                editModal.className = 'image-edit-modal';
                editModal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>📝 编辑立即加入卡片</h3>
                            <button onclick="this.closest('.image-edit-modal').remove()" class="close-btn">×</button>
                        </div>
                        <div class="modal-body">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">按钮文字:</label>
                                <input type="text" id="editButtonText" value="${currentButtonText}" 
                                       style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">主标题:</label>
                                <input type="text" id="editJoinTitle" value="${currentTitle}" 
                                       style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">副标题:</label>
                                <textarea id="editJoinSubtitle" rows="3" 
                                          style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;">${currentSubtitle}</textarea>
                            </div>
                            <div style="text-align: center;">
                                <button onclick="saveJoinCardChanges()" class="upload-btn" style="margin-right: 10px;">保存修改</button>
                                <button onclick="this.closest('.image-edit-modal').remove()" class="upload-btn" style="background: #6c757d;">取消</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(editModal);
            }
        }

        // 保存立即加入卡片的修改
        function saveJoinCardChanges() {
            const buttonText = document.getElementById('editButtonText').value.trim();
            const titleText = document.getElementById('editJoinTitle').value.trim();
            const subtitleText = document.getElementById('editJoinSubtitle').value.trim();
            
            if (buttonText) {
                const joinButton = document.getElementById('joinButton');
                if (joinButton) {
                    joinButton.textContent = buttonText;
                    saveToLocalStorage('joinButtonText', buttonText);
                }
            }
            
            if (titleText) {
                const joinTitle = document.querySelector('.join-title');
                if (joinTitle) {
                    joinTitle.textContent = titleText;
                    saveToLocalStorage('joinTitleText', titleText);
                }
            }
            
            if (subtitleText) {
                const joinSubtitle = document.querySelector('.join-subtitle');
                if (joinSubtitle) {
                    joinSubtitle.textContent = subtitleText;
                    saveToLocalStorage('joinSubtitleText', subtitleText);
                }
            }
            
            // 关闭模态框
            document.querySelector('.image-edit-modal').remove();
            
            alert('✅ 立即加入卡片已更新！');
        }

        // 编辑轮播海报
        function editCarouselImages() {
            showCarouselEditModal();
        }
        
        // 显示轮播编辑模态框
        function showCarouselEditModal() {
            const modal = document.getElementById('imageEditModal');
            const title = modal.querySelector('h3');
            const modalBody = modal.querySelector('.modal-body');
            
            title.textContent = '🖼️ 编辑轮播海报';
            
            // 创建轮播图片编辑界面
            const carouselEditHTML = `
                <div class="carousel-edit-container">
                    <p style="margin-bottom: 20px; color: #666;">点击下方图片位置上传新图片，支持本地文件和手机相册</p>
                    <div class="carousel-images-grid">
                        <div class="carousel-image-item" data-index="0">
                            <div class="image-preview" id="preview-0">
                                <span class="upload-text">轮播图 1<br>点击上传</span>
                            </div>
                            <input type="file" id="file-0" accept="image/*" style="display: none;" onchange="handleImageUpload(0, this)">
                            <div class="upload-buttons">
                                <button onclick="selectFromGallery(0)" class="upload-btn">📱 相册</button>
                                <button onclick="capturePhoto(0)" class="upload-btn">📷 拍照</button>
                                <button onclick="removeCarouselImage(0)" class="remove-btn">移除</button>
                            </div>
                        </div>
                        <div class="carousel-image-item" data-index="1">
                            <div class="image-preview" id="preview-1">
                                <span class="upload-text">轮播图 2<br>点击上传</span>
                            </div>
                            <input type="file" id="file-1" accept="image/*" style="display: none;" onchange="handleImageUpload(1, this)">
                            <div class="upload-buttons">
                                <button onclick="selectFromGallery(1)" class="upload-btn">📱 相册</button>
                                <button onclick="capturePhoto(1)" class="upload-btn">📷 拍照</button>
                                <button onclick="removeCarouselImage(1)" class="remove-btn">移除</button>
                            </div>
                        </div>
                        <div class="carousel-image-item" data-index="2">
                            <div class="image-preview" id="preview-2">
                                <span class="upload-text">轮播图 3<br>点击上传</span>
                            </div>
                            <input type="file" id="file-2" accept="image/*" style="display: none;" onchange="handleImageUpload(2, this)">
                            <div class="upload-buttons">
                                <button onclick="selectFromGallery(2)" class="upload-btn">📱 相册</button>
                                <button onclick="capturePhoto(2)" class="upload-btn">📷 拍照</button>
                                <button onclick="removeCarouselImage(2)" class="remove-btn">移除</button>
                            </div>
                        </div>
                        <div class="carousel-image-item" data-index="3">
                            <div class="image-preview" id="preview-3">
                                <span class="upload-text">轮播图 4<br>点击上传</span>
                            </div>
                            <input type="file" id="file-3" accept="image/*" style="display: none;" onchange="handleImageUpload(3, this)">
                            <div class="upload-buttons">
                                <button onclick="selectFromGallery(3)" class="upload-btn">📱 相册</button>
                                <button onclick="capturePhoto(3)" class="upload-btn">📷 拍照</button>
                                <button onclick="removeCarouselImage(3)" class="remove-btn">移除</button>
                            </div>
                        </div>
                        <div class="carousel-image-item" data-index="4">
                            <div class="image-preview" id="preview-4">
                                <span class="upload-text">轮播图 5<br>点击上传</span>
                            </div>
                            <input type="file" id="file-4" accept="image/*" style="display: none;" onchange="handleImageUpload(4, this)">
                            <div class="upload-buttons">
                                <button onclick="selectFromGallery(4)" class="upload-btn">📱 相册</button>
                                <button onclick="capturePhoto(4)" class="upload-btn">📷 拍照</button>
                                <button onclick="removeCarouselImage(4)" class="remove-btn">移除</button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button onclick="saveCarouselImages()" class="save-btn">保存所有图片</button>
                        <button onclick="resetCarouselImages()" class="reset-btn">重置为默认</button>
                        <button onclick="closeImageEditModal()" class="cancel-btn">取消</button>
                    </div>
                </div>
            `;
            
            modalBody.innerHTML = carouselEditHTML;
            
            // 加载已保存的图片
            loadCarouselImagesForEdit();
            
            modal.style.display = 'block';
        }
        
        // 处理图片上传
        function handleImageUpload(index, input) {
            const file = input.files[0];
            if (!file) {
                console.error('没有选择文件');
                return;
            }
            
            // 检查文件类型
            if (!file.type.startsWith('image/')) {
                alert('请选择图片文件！');
                return;
            }
            
            // 检查文件大小 (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('图片文件大小不能超过5MB！');
                return;
            }
            
            // 显示上传进度
            const preview = document.getElementById(`preview-${index}`);
            if (!preview) {
                console.error(`找不到预览元素 preview-${index}`);
                return;
            }
            
            preview.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">
                <div>📤 上传中...</div>
            </div>`;
            
            try {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    if (!e.target || !e.target.result) {
                        console.error('文件读取结果为空');
                        preview.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #ff4444;">
                            <div>❌ 文件读取失败</div>
                        </div>`;
                        return;
                    }
                    
                    // 创建图片对象进行压缩和优化
                    const img = new Image();
                    
                    // 先设置错误处理
                    img.onerror = function() {
                        console.error('图片加载失败');
                        preview.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #ff4444;">
                            <div>❌ 图片加载失败</div>
                        </div>`;
                    };
                    
                    img.onload = function() {
                        try {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            // 设置画布尺寸，保持轮播图最佳比例 (16:9)
                            const maxWidth = 800;
                            const maxHeight = 450;
                            let { width, height } = img;
                            
                            // 计算缩放比例
                            const ratio = Math.min(maxWidth / width, maxHeight / height);
                            width *= ratio;
                            height *= ratio;
                            
                            // 设置画布为目标尺寸
                            canvas.width = maxWidth;
                            canvas.height = maxHeight;
                            
                            // 填充白色背景
                            ctx.fillStyle = '#FFFFFF';
                            ctx.fillRect(0, 0, canvas.width, canvas.height);
                            
                            // 居中绘制图片
                            const offsetX = (maxWidth - width) / 2;
                            const offsetY = (maxHeight - height) / 2;
                            ctx.drawImage(img, offsetX, offsetY, width, height);
                            
                            // 转换为优化后的数据URL
                            const optimizedDataUrl = canvas.toDataURL('image/jpeg', 0.85);
                            
                            // 更新预览
                            preview.innerHTML = `<img src="${optimizedDataUrl}" alt="轮播图 ${index + 1}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">`;
                            
                            // 临时存储图片数据
                            if (!window.tempCarouselImages) {
                                window.tempCarouselImages = {};
                            }
                            window.tempCarouselImages[index] = optimizedDataUrl;
                            
                            console.log(`轮播图 ${index + 1} 上传成功，原始大小: ${(file.size / 1024).toFixed(1)}KB，优化后大小: ${(optimizedDataUrl.length * 0.75 / 1024).toFixed(1)}KB`);
                        } catch (error) {
                            console.error('处理图片时出错:', error);
                            preview.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #ff4444;">
                                <div>❌ 图片处理失败: ${error.message}</div>
                            </div>`;
                        }
                    };
                    
                    // 设置图片源并处理跨域问题
                    img.crossOrigin = 'anonymous';
                    img.src = e.target.result;
                };
                
                reader.onerror = function(error) {
                    console.error('文件读取失败:', error);
                    preview.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #ff4444;">
                        <div>❌ 文件读取失败</div>
                    </div>`;
                };
                
                reader.readAsDataURL(file);
            } catch (error) {
                console.error('文件处理失败:', error);
                preview.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #ff4444;">
                    <div>❌ 文件处理失败</div>
                </div>`;
            }
        }
        
        // 触发手机相册选择
        function selectFromGallery(index) {
            const input = document.getElementById(`file-${index}`);
            // 设置accept属性以优化移动端体验
            input.accept = 'image/*';
            input.removeAttribute('capture'); // 确保可以从相册选择
            
            // 为移动端优化文件选择器触发
            if (navigator.userAgent.match(/Android|iPhone|iPad|iPod/i)) {
                // 创建一个临时的点击事件
                const clickEvent = new MouseEvent('click', {
                    view: window,
                    bubbles: true,
                    cancelable: true
                });
                input.dispatchEvent(clickEvent);
            } else {
                input.click();
            }
            
            // 添加焦点和可见性，帮助移动设备识别
            input.style.position = 'fixed';
            input.style.bottom = '0';
            input.style.opacity = '0.01';
            input.style.height = '30px';
            input.style.display = 'block';
            input.focus();
            
            // 短暂显示后隐藏
            setTimeout(() => {
                input.style.display = 'none';
            }, 1000);
        }
        
        // 触发拍照
        function capturePhoto(index) {
            const input = document.getElementById(`file-${index}`);
            input.accept = 'image/*';
            input.capture = 'environment'; // 使用后置摄像头
            
            // 为移动端优化文件选择器触发
            if (navigator.userAgent.match(/Android|iPhone|iPad|iPod/i)) {
                // 创建一个临时的点击事件
                const clickEvent = new MouseEvent('click', {
                    view: window,
                    bubbles: true,
                    cancelable: true
                });
                input.dispatchEvent(clickEvent);
            } else {
                input.click();
            }
            
            // 添加焦点和可见性，帮助移动设备识别
            input.style.position = 'fixed';
            input.style.bottom = '0';
            input.style.opacity = '0.01';
            input.style.height = '30px';
            input.style.display = 'block';
            input.focus();
            
            // 短暂显示后隐藏
            setTimeout(() => {
                input.style.display = 'none';
            }, 1000);
        }
        
        // 移除轮播图片
        function removeCarouselImage(index) {
            const preview = document.getElementById(`preview-${index}`);
            preview.innerHTML = `<span class="upload-text">轮播图 ${index + 1}<br>点击上传</span>`;
            
            if (window.tempCarouselImages) {
                delete window.tempCarouselImages[index];
            }
        }
        
        // 保存轮播图片
        function saveCarouselImages() {
            if (!window.tempCarouselImages || Object.keys(window.tempCarouselImages).length === 0) {
                alert('请至少上传一张图片！');
                return;
            }
            
            try {
                // 保存到localStorage
                const carouselImages = [];
                for (let i = 0; i < 5; i++) {
                    if (window.tempCarouselImages[i]) {
                        carouselImages[i] = window.tempCarouselImages[i];
                    }
                }
                
                saveToLocalStorage('carouselImages', carouselImages);
                
                // 应用到页面
                applyCarouselImages(carouselImages);
                
                alert(`成功保存 ${Object.keys(window.tempCarouselImages).length} 张轮播图片！`);
                closeImageEditModal();
                
            } catch (error) {
                console.error('保存轮播图片失败:', error);
                alert('保存失败，请重试！');
            }
        }
        
        // 应用轮播图片到页面
        function applyCarouselImages(images) {
            const slides = document.querySelectorAll('.carousel-slide');
            
            images.forEach((imageUrl, index) => {
                if (imageUrl && slides[index]) {
                    if (index === 0) {
                        // 第一个轮播保持原有内容结构，只更新背景
                        const slideContent = slides[index].querySelector('.slide-content');
                        if (slideContent) {
                            slideContent.style.backgroundImage = `url(${imageUrl})`;
                            slideContent.style.backgroundSize = 'cover';
                            slideContent.style.backgroundPosition = 'center';
                        }
                    } else {
                        // 其他轮播直接设置背景图片
                        const slideBg = slides[index].querySelector('.slide-bg');
                        if (slideBg) {
                            slideBg.style.backgroundImage = `url(${imageUrl})`;
                            slideBg.style.backgroundSize = 'cover';
                            slideBg.style.backgroundPosition = 'center';
                        }
                    }
                }
            });
        }
        
        // 重置轮播图片
        function resetCarouselImages() {
            if (confirm('确定要重置所有轮播图片为默认样式吗？')) {
                // 清除localStorage
                localStorage.removeItem('pinyuClub_carouselImages');
                
                // 重置页面显示
                const slides = document.querySelectorAll('.carousel-slide');
                
                // 重置第一个轮播
                if (slides[0]) {
                    const slideContent = slides[0].querySelector('.slide-content');
                    if (slideContent) {
                        slideContent.style.backgroundImage = '';
                    }
                }
                
                // 重置其他轮播为默认渐变
                const defaultGradients = [
                    '',
                    'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                    'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                    'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)'
                ];
                
                for (let i = 1; i < slides.length && i < defaultGradients.length; i++) {
                    const slideBg = slides[i].querySelector('.slide-bg');
                    if (slideBg) {
                        slideBg.style.background = defaultGradients[i];
                        slideBg.style.backgroundImage = '';
                    }
                }
                
                // 重置编辑界面
                loadCarouselImagesForEdit();
                
                alert('轮播图片已重置为默认样式！');
            }
        }
        
        // 加载轮播图片到编辑界面
        function loadCarouselImagesForEdit() {
            const savedImages = loadFromLocalStorage('carouselImages') || [];
            window.tempCarouselImages = {};
            
            for (let i = 0; i < 5; i++) {
                const preview = document.getElementById(`preview-${i}`);
                if (preview) {
                    if (savedImages[i]) {
                        preview.innerHTML = `<img src="${savedImages[i]}" alt="轮播图 ${i + 1}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">`;
                        window.tempCarouselImages[i] = savedImages[i];
                    } else {
                        preview.innerHTML = `<span class="upload-text">轮播图 ${i + 1}<br>点击上传</span>`;
                    }
                }
            }
        }
        
        // 关闭图片编辑模态框
        function closeImageEditModal() {
            const modal = document.getElementById('imageEditModal');
            modal.style.display = 'none';
            window.tempCarouselImages = {};
        }

        // 加载保存的兴趣轮播图片
        function loadSavedInterestImages() {
            const savedImages = loadFromLocalStorage('interestCarouselImages');
            if (savedImages && savedImages.length > 0) {
                applyInterestImages(savedImages);
            }
        }

        // 编辑兴趣宝藏图片
        function editInterestImages() {
            showInterestImagesEditModal();
        }
        
        // 显示兴趣宝藏图片编辑模态框
        function showInterestImagesEditModal() {
            // 获取当前保存的图片
            const savedImages = loadFromLocalStorage('interestCarouselImages') || [];
            
            const modal = document.createElement('div');
            modal.className = 'interest-images-edit-modal';
            modal.innerHTML = `
                <div class="interest-images-edit-content">
                    <div class="interest-images-edit-header">
                        <h3>兴趣宝藏轮播图片编辑</h3>
                        <button onclick="closeInterestImagesModal()" class="close-btn">×</button>
                    </div>
                    <div class="interest-images-edit-body">
                        <div class="interest-images-grid">
                            ${generateInterestImageSlots(savedImages)}
                        </div>
                        <div class="interest-edit-tips">
                            <p>💡 提示：</p>
                            <ul>
                                <li>支持上传 JPG、PNG、GIF 格式图片</li>
                                <li>建议图片尺寸比例为 16:9</li>
                                <li>文件大小不超过 5MB</li>
                                <li>第一张为主要展示内容，其他为背景图片</li>
                            </ul>
                        </div>
                    </div>
                    <div class="interest-images-edit-footer">
                        <button onclick="resetInterestImages()" class="reset-btn">重置默认</button>
                        <button onclick="saveInterestImages()" class="save-btn">保存图片</button>
                        <button onclick="closeInterestImagesModal()" class="cancel-btn">取消</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // 生成兴趣图片上传槽位
        function generateInterestImageSlots(savedImages) {
            const titles = [
                '主要内容区 (带文字)',
                '背景图片 1',
                '背景图片 2', 
                '背景图片 3'
            ];
            
            let html = '';
            for (let i = 0; i < 4; i++) {
                const savedImage = savedImages[i];
                html += `
                    <div class="interest-image-slot">
                        <div class="interest-slot-header">
                            <h4>${titles[i]}</h4>
                        </div>
                        <div class="interest-image-preview" id="interestPreview${i}">
                            ${savedImage ? 
                                `<img src="${savedImage}" alt="预览图片" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                                 <button onclick="removeInterestImage(${i})" class="remove-image-btn">×</button>` :
                                `<div class="upload-placeholder">
                                    <div class="upload-icon">📷</div>
                                    <div class="upload-text">点击上传图片</div>
                                </div>`
                            }
                        </div>
                        <input type="file" id="interestImageInput${i}" accept="image/*" style="display: none;" onchange="handleInterestImageUpload(${i}, this)">
                        <div class="interest-slot-actions">
                            <button onclick="document.getElementById('interestImageInput${i}').click()" class="upload-btn">
                                ${savedImage ? '更换图片' : '上传图片'}
                            </button>
                            <button onclick="openInterestCamera(${i})" class="camera-btn">📱 相册</button>
                        </div>
                    </div>
                `;
            }
            return html;
        }
        
        // 处理兴趣图片上传
        function handleInterestImageUpload(index, input) {
            const file = input.files[0];
            if (!file) return;
            
            // 验证文件类型
            if (!file.type.startsWith('image/')) {
                alert('请选择图片文件！');
                return;
            }
            
            // 验证文件大小 (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('图片文件大小不能超过 5MB！');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageUrl = e.target.result;
                updateInterestImagePreview(index, imageUrl);
            };
            reader.readAsDataURL(file);
        }
        
        // 更新兴趣图片预览
        function updateInterestImagePreview(index, imageUrl) {
            const preview = document.getElementById(`interestPreview${index}`);
            if (preview) {
                preview.innerHTML = `
                    <img src="${imageUrl}" alt="预览图片" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                    <button onclick="removeInterestImage(${index})" class="remove-image-btn">×</button>
                `;
                
                // 更新按钮文字
                const uploadBtn = preview.parentElement.querySelector('.upload-btn');
                if (uploadBtn) {
                    uploadBtn.textContent = '更换图片';
                }
            }
        }
        
        // 移除兴趣图片
        function removeInterestImage(index) {
            const preview = document.getElementById(`interestPreview${index}`);
            if (preview) {
                preview.innerHTML = `
                    <div class="upload-placeholder">
                        <div class="upload-icon">📷</div>
                        <div class="upload-text">点击上传图片</div>
                    </div>
                `;
                
                // 更新按钮文字
                const uploadBtn = preview.parentElement.querySelector('.upload-btn');
                if (uploadBtn) {
                    uploadBtn.textContent = '上传图片';
                }
                
                // 清空文件输入
                const input = document.getElementById(`interestImageInput${index}`);
                if (input) {
                    input.value = '';
                }
            }
        }
        
        // 打开相机/相册 (移动端)
        function openInterestCamera(index) {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                // 在移动设备上，这会打开相机或相册选择
                const input = document.getElementById(`interestImageInput${index}`);
                if (input) {
                    input.setAttribute('capture', 'environment');
                    input.click();
                }
            } else {
                alert('📱 相机功能需要在移动设备上使用');
            }
        }
        
        // 保存兴趣图片
        function saveInterestImages() {
            const images = [];
            
            for (let i = 0; i < 4; i++) {
                const preview = document.getElementById(`interestPreview${i}`);
                const img = preview?.querySelector('img');
                if (img) {
                    images[i] = img.src;
                } else {
                    images[i] = null;
                }
            }
            
            saveToLocalStorage('interestCarouselImages', images);
            applyInterestImages(images);
            closeInterestImagesModal();
            alert('兴趣宝藏轮播图片已保存！');
        }
        
        // 应用兴趣图片到页面
        function applyInterestImages(images) {
            const slides = document.querySelectorAll('.interest-carousel-slide');
            
            images.forEach((imageUrl, index) => {
                if (imageUrl && slides[index]) {
                    if (index === 0) {
                        // 第一张保持文字内容，添加背景图片
                        slides[index].style.backgroundImage = `url(${imageUrl})`;
                        slides[index].style.backgroundSize = 'cover';
                        slides[index].style.backgroundPosition = 'center';
                    } else {
                        // 其他张直接设置背景
                        const bgDiv = slides[index].querySelector('.interest-slide-bg');
                        if (bgDiv) {
                            bgDiv.style.backgroundImage = `url(${imageUrl})`;
                            bgDiv.style.backgroundSize = 'cover';
                            bgDiv.style.backgroundPosition = 'center';
                        }
                    }
                }
            });
        }
        
        // 重置兴趣图片为默认
        function resetInterestImages() {
            // 清除所有预览
            for (let i = 0; i < 4; i++) {
                removeInterestImage(i);
            }
            
            // 恢复默认样式
            const slides = document.querySelectorAll('.interest-carousel-slide');
            slides.forEach((slide, index) => {
                if (index === 0) {
                    slide.style.backgroundImage = '';
                    slide.style.backgroundSize = '';
                    slide.style.backgroundPosition = '';
                } else {
                    const bgDiv = slide.querySelector('.interest-slide-bg');
                    if (bgDiv) {
                        bgDiv.style.backgroundImage = '';
                        bgDiv.style.backgroundSize = '';
                        bgDiv.style.backgroundPosition = '';
                        // 恢复原始渐变
                        const gradients = [
                            'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                            'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                            'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)'
                        ];
                        if (gradients[index - 1]) {
                            bgDiv.style.background = gradients[index - 1];
                        }
                    }
                }
            });
        }
        
        // 关闭兴趣图片编辑模态框
        function closeInterestImagesModal() {
            const modal = document.querySelector('.interest-images-edit-modal');
            if (modal) {
                modal.remove();
            }
        }

        // 编辑会员轮播样式
        function editMemberStyle() {
            showMemberStyleEditModal();
        }
        
        // 显示会员轮播样式编辑模态框
        function showMemberStyleEditModal() {
            // 获取当前样式设置
            const currentSettings = loadFromLocalStorage('memberCarouselSettings') || {
                avatarSize: 60,
                nameSize: 10,
                animationSpeed: 20,
                displayCount: 8,
                gap: 16
            };
            
            const modal = document.createElement('div');
            modal.className = 'member-style-edit-modal';
            modal.innerHTML = `
                <div class="member-style-edit-content">
                    <div class="member-style-edit-header">
                        <h3>会员轮播样式编辑</h3>
                        <button onclick="closeMemberStyleModal()" class="close-btn">×</button>
                    </div>
                    <div class="member-style-edit-body">
                        <div class="style-setting-group">
                            <label>头像大小 (px):</label>
                            <input type="range" id="avatarSizeSlider" min="40" max="80" value="${currentSettings.avatarSize}" oninput="updateAvatarSizePreview(this.value)">
                            <span id="avatarSizeValue">${currentSettings.avatarSize}px</span>
                        </div>
                        
                        <div class="style-setting-group">
                            <label>名字字体大小 (px):</label>
                            <input type="range" id="nameSizeSlider" min="8" max="14" value="${currentSettings.nameSize}" oninput="updateNameSizePreview(this.value)">
                            <span id="nameSizeValue">${currentSettings.nameSize}px</span>
                        </div>
                        
                        <div class="style-setting-group">
                            <label>轮播速度 (秒):</label>
                            <input type="range" id="speedSlider" min="10" max="30" value="${currentSettings.animationSpeed}" oninput="updateSpeedPreview(this.value)">
                            <span id="speedValue">${currentSettings.animationSpeed}s</span>
                        </div>
                        
                        <div class="style-setting-group">
                            <label>显示数量:</label>
                            <input type="range" id="countSlider" min="6" max="12" value="${currentSettings.displayCount}" oninput="updateCountPreview(this.value)">
                            <span id="countValue">${currentSettings.displayCount}个</span>
                        </div>
                        
                        <div class="style-setting-group">
                            <label>间距 (px):</label>
                            <input type="range" id="gapSlider" min="8" max="24" value="${currentSettings.gap}" oninput="updateGapPreview(this.value)">
                            <span id="gapValue">${currentSettings.gap}px</span>
                        </div>
                        
                        <div class="member-style-preview">
                            <h4>预览效果:</h4>
                            <div class="preview-container" id="memberStylePreview">
                                <!-- 预览内容将动态生成 -->
                            </div>
                        </div>
                    </div>
                    <div class="member-style-edit-footer">
                        <button onclick="resetMemberStyle()" class="reset-btn">重置默认</button>
                        <button onclick="saveMemberStyleChanges()" class="save-btn">保存设置</button>
                        <button onclick="closeMemberStyleModal()" class="cancel-btn">取消</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            updateMemberStylePreview();
        }
        
        // 更新头像大小预览
        function updateAvatarSizePreview(value) {
            document.getElementById('avatarSizeValue').textContent = value + 'px';
            updateMemberStylePreview();
        }
        
        // 更新名字字体大小预览
        function updateNameSizePreview(value) {
            document.getElementById('nameSizeValue').textContent = value + 'px';
            updateMemberStylePreview();
        }
        
        // 更新轮播速度预览
        function updateSpeedPreview(value) {
            document.getElementById('speedValue').textContent = value + 's';
            updateMemberStylePreview();
        }
        
        // 更新显示数量预览
        function updateCountPreview(value) {
            document.getElementById('countValue').textContent = value + '个';
            updateMemberStylePreview();
        }
        
        // 更新间距预览
        function updateGapPreview(value) {
            document.getElementById('gapValue').textContent = value + 'px';
            updateMemberStylePreview();
        }
        
        // 更新会员样式预览
        function updateMemberStylePreview() {
            const preview = document.getElementById('memberStylePreview');
            if (!preview) return;
            
            const avatarSize = document.getElementById('avatarSizeSlider')?.value || 60;
            const nameSize = document.getElementById('nameSizeSlider')?.value || 10;
            const gap = document.getElementById('gapSlider')?.value || 16;
            const count = document.getElementById('countSlider')?.value || 8;
            
            let previewHTML = '<div class="preview-track" style="display: flex; gap: ' + gap + 'px; overflow: hidden;">';
            
            for (let i = 0; i < Math.min(count, 4); i++) {
                previewHTML += `
                    <div class="preview-member" style="display: flex; flex-direction: column; align-items: center;">
                        <div style="width: ${avatarSize}px; height: ${avatarSize}px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: ${avatarSize * 0.4}px; margin-bottom: 6px;">
                            ${String.fromCharCode(65 + i)}
                        </div>
                        <div style="font-size: ${nameSize}px; color: #666; text-align: center;">用户${i + 1}</div>
                    </div>
                `;
            }
            
            previewHTML += '</div>';
            preview.innerHTML = previewHTML;
        }
        
        // 保存会员样式设置
        function saveMemberStyleChanges() {
            const settings = {
                avatarSize: parseInt(document.getElementById('avatarSizeSlider').value),
                nameSize: parseInt(document.getElementById('nameSizeSlider').value),
                animationSpeed: parseInt(document.getElementById('speedSlider').value),
                displayCount: parseInt(document.getElementById('countSlider').value),
                gap: parseInt(document.getElementById('gapSlider').value)
            };
            
            saveToLocalStorage('memberCarouselSettings', settings);
            applyMemberStyleSettings(settings);
            closeMemberStyleModal();
            alert('会员轮播样式设置已保存！');
        }
        
        // 应用会员样式设置
        function applyMemberStyleSettings(settings) {
            // 更新CSS变量或直接修改样式
            const style = document.createElement('style');
            style.id = 'memberStyleOverride';
            
            // 移除旧的样式覆盖
            const oldStyle = document.getElementById('memberStyleOverride');
            if (oldStyle) {
                oldStyle.remove();
            }
            
            style.textContent = `
                .member-avatar {
                    width: ${settings.avatarSize}px !important;
                    height: ${settings.avatarSize}px !important;
                }
                .member-name {
                    font-size: ${settings.nameSize}px !important;
                }
                .members-carousel-track {
                    gap: ${settings.gap}px !important;
                    animation: scroll ${settings.animationSpeed}s linear infinite !important;
                }
                .member-avatar svg {
                    width: ${settings.avatarSize * 0.67}px !important;
                    height: ${settings.avatarSize * 0.67}px !important;
                }
            `;
            
            document.head.appendChild(style);
            
            // 重新初始化会员轮播以应用新的显示数量
            if (settings.displayCount !== 8) {
                initMembersCarousel(settings.displayCount);
            }
        }
        
        // 重置会员样式为默认
        function resetMemberStyle() {
            const defaultSettings = {
                avatarSize: 60,
                nameSize: 10,
                animationSpeed: 20,
                displayCount: 8,
                gap: 16
            };
            
            // 更新滑块值
            document.getElementById('avatarSizeSlider').value = defaultSettings.avatarSize;
            document.getElementById('nameSizeSlider').value = defaultSettings.nameSize;
            document.getElementById('speedSlider').value = defaultSettings.animationSpeed;
            document.getElementById('countSlider').value = defaultSettings.displayCount;
            document.getElementById('gapSlider').value = defaultSettings.gap;
            
            // 更新显示值
            updateAvatarSizePreview(defaultSettings.avatarSize);
            updateNameSizePreview(defaultSettings.nameSize);
            updateSpeedPreview(defaultSettings.animationSpeed);
            updateCountPreview(defaultSettings.displayCount);
            updateGapPreview(defaultSettings.gap);
        }
        
        // 关闭会员样式编辑模态框
        function closeMemberStyleModal() {
            const modal = document.querySelector('.member-style-edit-modal');
            if (modal) {
                modal.remove();
            }
        }

        // 编辑推荐活动
        function editActivityCards() {
            showActivityEditModal();
        }
        
        // 显示推荐活动编辑模态框
        function showActivityEditModal() {
            const modal = document.getElementById('imageEditModal');
            const title = modal.querySelector('h3');
            const modalBody = modal.querySelector('.modal-body');
            
            title.textContent = '🎪 编辑推荐活动';
            
            // 获取当前活动数据
            const currentActivities = loadFromLocalStorage('activityCards') || getDefaultActivities();
            
            // 创建活动编辑界面
            const activityEditHTML = `
                <div class="activity-edit-container">
                    <p style="margin-bottom: 20px; color: #666;">编辑活动信息，支持上传封面图片和修改活动内容</p>
                    <div class="activities-edit-grid">
                        ${currentActivities.map((activity, index) => `
                            <div class="activity-edit-item" data-index="${index}">
                                <div class="activity-cover-section">
                                    <div class="activity-cover-preview" id="activity-cover-${index}">
                                        ${activity.image ? 
                                            `<img src="${activity.image}" alt="活动封面" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">` :
                                            `<span class="upload-text">活动封面<br>点击上传</span>`
                                        }
                                    </div>
                                    <input type="file" id="activity-file-${index}" accept="image/*" style="display: none;" onchange="handleActivityImageUpload(${index}, this)">
                                    <div class="activity-upload-buttons">
                                        <button onclick="selectActivityImageFromGallery(${index})" class="upload-btn">📱 相册</button>
                                        <button onclick="captureActivityPhoto(${index})" class="upload-btn">📷 拍照</button>
                                        <button onclick="removeActivityImage(${index})" class="remove-btn">移除</button>
                                    </div>
                                </div>
                                <div class="activity-content-section">
                                    <div class="form-group">
                                        <label>活动标题:</label>
                                        <input type="text" id="activity-title-${index}" value="${activity.title}" placeholder="输入活动标题" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label>活动描述:</label>
                                        <textarea id="activity-desc-${index}" placeholder="输入活动描述" class="form-textarea">${activity.description}</textarea>
                                    </div>
                                    <div class="form-group">
                                        <label>活动时间:</label>
                                        <input type="text" id="activity-time-${index}" value="${activity.time}" placeholder="例如: 12月25日 19:00" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label>活动地点:</label>
                                        <input type="text" id="activity-location-${index}" value="${activity.location || ''}" placeholder="输入活动地点" class="form-input">
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="modal-actions">
                        <button onclick="saveActivityCards()" class="save-btn">保存所有活动</button>
                        <button onclick="resetActivityCards()" class="reset-btn">重置为默认</button>
                        <button onclick="closeImageEditModal()" class="cancel-btn">取消</button>
                    </div>
                </div>
            `;
            
            modalBody.innerHTML = activityEditHTML;
            
            // 初始化临时数据
            window.tempActivityData = JSON.parse(JSON.stringify(currentActivities));
            
            modal.style.display = 'block';
        }
        
        // 获取默认活动数据
        function getDefaultActivities() {
            return [
                {
                    title: "周末户外徒步",
                    description: "探索城市周边的自然风光，结识志同道合的朋友",
                    time: "12月23日 09:00",
                    location: "香山公园",
                    image: null
                },
                {
                    title: "咖啡品鉴会",
                    description: "专业咖啡师带你品味不同产地的精品咖啡",
                    time: "12月24日 14:00",
                    location: "星巴克臻选店",
                    image: null
                },
                {
                    title: "圣诞主题聚会",
                    description: "温馨的圣诞聚会，交换礼物，分享节日快乐",
                    time: "12月25日 19:00",
                    location: "社区活动中心",
                    image: null
                }
            ];
        }
        
        // 处理活动图片上传
        function handleActivityImageUpload(index, input) {
            const file = input.files[0];
            if (!file) {
                console.error('未选择文件');
                return;
            }
            
            // 检查文件类型
            if (!file.type.startsWith('image/')) {
                alert('请选择图片文件！');
                return;
            }
            
            // 检查文件大小 (3MB)
            if (file.size > 3 * 1024 * 1024) {
                alert('图片文件大小不能超过3MB！');
                return;
            }
            
            // 显示上传进度
            const preview = document.getElementById(`activity-cover-${index}`);
            if (!preview) {
                console.error(`找不到预览元素: activity-cover-${index}`);
                return;
            }
            
            preview.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">
                <div>📤 上传中...</div>
            </div>`;
            
            const reader = new FileReader();
            reader.onerror = function() {
                console.error('文件读取失败');
                preview.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #ff4444;">
                    <div>❌ 文件读取失败</div>
                </div>`;
            };
            
            reader.onload = function(e) {
                if (!e.target || !e.target.result) {
                    console.error('文件读取结果为空');
                    preview.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #ff4444;">
                        <div>❌ 文件读取失败</div>
                    </div>`;
                    return;
                }
                
                // 创建图片对象进行压缩和优化
                const img = new Image();
                img.onerror = function() {
                    console.error('图片加载失败');
                    preview.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #ff4444;">
                        <div>❌ 图片加载失败</div>
                    </div>`;
                };
                
                img.onload = function() {
                    try {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // 固定画布尺寸为活动卡片的标准尺寸 (4:3)
                        const targetWidth = 400;
                        const targetHeight = 300;
                        
                        // 创建一个固定尺寸的画布
                        canvas.width = targetWidth;
                        canvas.height = targetHeight;
                        
                        // 先填充白色背景
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, 0, targetWidth, targetHeight);
                        
                        // 计算缩放和居中参数
                        let drawWidth, drawHeight, drawX, drawY;
                        const sourceRatio = img.width / img.height;
                        const targetRatio = targetWidth / targetHeight;
                        
                        if (sourceRatio > targetRatio) {
                            // 原图更宽，以高度为基准进行缩放
                            drawHeight = targetHeight;
                            drawWidth = drawHeight * sourceRatio;
                            drawX = (targetWidth - drawWidth) / 2;
                            drawY = 0;
                        } else {
                            // 原图更高，以宽度为基准进行缩放
                            drawWidth = targetWidth;
                            drawHeight = drawWidth / sourceRatio;
                            drawX = 0;
                            drawY = (targetHeight - drawHeight) / 2;
                        }
                        
                        // 绘制缩放后的图片（保持原比例，居中显示）
                        ctx.drawImage(
                            img,
                            drawX, drawY, drawWidth, drawHeight
                        );
                        
                        // 转换为优化后的数据URL
                        const optimizedDataUrl = canvas.toDataURL('image/jpeg', 0.85);
                        
                        // 更新预览
                        preview.innerHTML = `<img src="${optimizedDataUrl}" alt="活动封面" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;">`;
                        
                        // 更新临时数据
                        if (!window.tempActivityData) {
                            window.tempActivityData = getDefaultActivities();
                        }
                        window.tempActivityData[index].image = optimizedDataUrl;
                        
                        console.log(`活动 ${index + 1} 封面上传成功，原始大小: ${(file.size / 1024).toFixed(1)}KB，优化后大小: ${(optimizedDataUrl.length * 0.75 / 1024).toFixed(1)}KB`);
                    } catch (error) {
                        console.error('处理图片时出错:', error);
                        preview.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #ff4444;">
                            <div>❌ 图片处理失败</div>
                        </div>`;
                    }
                };
                
                // 设置图片源并处理跨域问题
                img.crossOrigin = 'anonymous';
                img.src = e.target.result;
            };
            
            reader.onerror = function() {
                console.error('文件读取失败');
                preview.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #ff4444;">
                    <div>❌ 文件读取失败</div>
                </div>`;
            };
            
            reader.readAsDataURL(file);
        }
        
        // 从相册选择活动图片
        function selectActivityImageFromGallery(index) {
            const input = document.getElementById(`activity-file-${index}`);
            input.accept = 'image/*';
            input.removeAttribute('capture'); // 确保可以从相册选择
            
            // 为移动端优化文件选择器触发
            if (navigator.userAgent.match(/Android|iPhone|iPad|iPod/i)) {
                // 创建一个临时的点击事件
                const clickEvent = new MouseEvent('click', {
                    view: window,
                    bubbles: true,
                    cancelable: true
                });
                input.dispatchEvent(clickEvent);
            } else {
                input.click();
            }
            
            // 添加焦点和可见性，帮助移动设备识别
            input.style.position = 'fixed';
            input.style.bottom = '0';
            input.style.opacity = '0.01';
            input.style.height = '30px';
            input.style.display = 'block';
            input.focus();
            
            // 短暂显示后隐藏
            setTimeout(() => {
                input.style.display = 'none';
            }, 1000);
        }
        
        // 拍照上传活动图片
        function captureActivityPhoto(index) {
            const input = document.getElementById(`activity-file-${index}`);
            input.accept = 'image/*';
            input.capture = 'environment'; // 使用后置摄像头
            
            // 为移动端优化文件选择器触发
            if (navigator.userAgent.match(/Android|iPhone|iPad|iPod/i)) {
                // 创建一个临时的点击事件
                const clickEvent = new MouseEvent('click', {
                    view: window,
                    bubbles: true,
                    cancelable: true
                });
                input.dispatchEvent(clickEvent);
            } else {
                input.click();
            }
            
            // 添加焦点和可见性，帮助移动设备识别
            input.style.position = 'fixed';
            input.style.bottom = '0';
            input.style.opacity = '0.01';
            input.style.height = '30px';
            input.style.display = 'block';
            input.focus();
            
            // 短暂显示后隐藏
            setTimeout(() => {
                input.style.display = 'none';
            }, 1000);
        }
        
        // 移除活动图片
        function removeActivityImage(index) {
            const preview = document.getElementById(`activity-cover-${index}`);
            preview.innerHTML = `<span class="upload-text">活动封面<br>点击上传</span>`;
            
            if (window.tempActivityData && window.tempActivityData[index]) {
                window.tempActivityData[index].image = null;
            }
        }
        
        // 保存活动卡片
        function saveActivityCards() {
            if (!window.tempActivityData) {
                alert('没有可保存的活动数据！');
                return;
            }
            
            try {
                // 收集表单数据
                window.tempActivityData.forEach((activity, index) => {
                    const title = document.getElementById(`activity-title-${index}`);
                    const desc = document.getElementById(`activity-desc-${index}`);
                    const time = document.getElementById(`activity-time-${index}`);
                    const location = document.getElementById(`activity-location-${index}`);
                    
                    if (title) activity.title = title.value.trim();
                    if (desc) activity.description = desc.value.trim();
                    if (time) activity.time = time.value.trim();
                    if (location) activity.location = location.value.trim();
                });
                
                // 保存到localStorage
                saveToLocalStorage('activityCards', window.tempActivityData);
                
                // 应用到页面
                applyActivityCards(window.tempActivityData);
                
                alert('推荐活动已成功保存！');
                closeImageEditModal();
                
            } catch (error) {
                console.error('保存推荐活动失败:', error);
                alert('保存失败，请重试！');
            }
        }
        
        // 应用活动卡片到页面
        function applyActivityCards(activities) {
            const eventsList = document.getElementById('eventsList');
            if (!eventsList) return;
            
            eventsList.innerHTML = activities.map(activity => `
                <div class="event-card" onclick="handleEventClick('${activity.title}')">
                    <div class="event-image">
                        ${activity.image ? 
                            `<img src="${activity.image}" alt="${activity.title}" style="width: 100%; height: 100%; object-fit: cover;">` :
                            `<div class="event-placeholder">📅</div>`
                        }
                    </div>
                    <div class="event-info">
                        <div class="event-title">${activity.title}</div>
                        <div class="event-desc">${activity.description}</div>
                        <div class="event-meta">
                            <span class="event-time">⏰ ${activity.time}</span>
                            ${activity.location ? `<span class="event-location">📍 ${activity.location}</span>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // 重置活动卡片
        function resetActivityCards() {
            if (confirm('确定要重置所有推荐活动为默认内容吗？')) {
                // 清除localStorage
                localStorage.removeItem('pinyuClub_activityCards');
                
                // 重置为默认数据
                const defaultActivities = getDefaultActivities();
                applyActivityCards(defaultActivities);
                
                // 重新加载编辑界面
                showActivityEditModal();
                
                alert('推荐活动已重置为默认内容！');
            }
        }

        // 显示图片编辑模态框
        function showImageEditModal(type) {
            const modal = document.createElement('div');
            modal.className = 'image-edit-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>${type === 'carousel' ? '🖼️ 编辑轮播海报' : '🎨 编辑兴趣宝藏图片'}</h3>
                        <button onclick="this.closest('.image-edit-modal').remove()" class="close-btn">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="upload-area">
                            <input type="file" id="imageUpload" accept="image/*" multiple style="display: none;">
                            <button onclick="document.getElementById('imageUpload').click()" class="upload-btn">
                                📁 选择本地图片
                            </button>
                            <button onclick="openCamera()" class="upload-btn">
                                📷 拍照上传
                            </button>
                        </div>
                        <div class="image-preview" id="imagePreview">
                            <!-- 图片预览区域 -->
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // 添加文件选择事件
            const fileInput = modal.querySelector('#imageUpload');
            fileInput.addEventListener('change', handleImageUpload);
        }

        // 处理图片上传
        function handleImageUpload(event) {
            const files = event.target.files;
            const preview = document.getElementById('imagePreview');
            
            for (let file of files) {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imgDiv = document.createElement('div');
                        imgDiv.className = 'preview-item';
                        imgDiv.innerHTML = `
                            <img src="${e.target.result}" alt="预览图片">
                            <button onclick="this.parentElement.remove()" class="remove-btn">删除</button>
                            <button onclick="applyImage('${e.target.result}')" class="apply-btn">应用</button>
                        `;
                        preview.appendChild(imgDiv);
                    };
                    reader.readAsDataURL(file);
                }
            }
        }

        // 应用图片到轮播
        function applyImage(imageSrc) {
            // 这里可以根据需要将图片应用到相应的轮播位置
            alert('图片已应用到轮播！');
        }

        // 打开相机
        function openCamera() {
            // 在实际应用中，这里会调用相机API
            alert('📷 相机功能需要在移动设备上使用\n\n在手机浏览器中可以直接调用相机拍照');
        }

        // 保存到本地存储
        function saveToLocalStorage(key, value) {
            try {
                localStorage.setItem(`pinyuClub_${key}`, JSON.stringify(value));
            } catch (error) {
                console.log('保存到本地存储失败:', error);
            }
        }

        // 从本地存储加载
        function loadFromLocalStorage(key) {
            try {
                const value = localStorage.getItem(`pinyuClub_${key}`);
                return value ? JSON.parse(value) : null;
            } catch (error) {
                console.log('从本地存储加载失败:', error);
                return null;
            }
        }

        // 初始化时加载保存的内容
        function loadSavedContent() {
            // 加载立即加入按钮文字
            const savedJoinText = loadFromLocalStorage('joinButtonText');
            if (savedJoinText) {
                const joinButton = document.getElementById('joinButton');
                if (joinButton) {
                    joinButton.textContent = savedJoinText;
                }
            }
            
            // 加载立即加入标题
            const savedJoinTitle = loadFromLocalStorage('joinTitleText');
            if (savedJoinTitle) {
                const joinTitle = document.querySelector('.join-title');
                if (joinTitle) {
                    joinTitle.textContent = savedJoinTitle;
                }
            }
            
            // 加载立即加入副标题
            const savedJoinSubtitle = loadFromLocalStorage('joinSubtitleText');
            if (savedJoinSubtitle) {
                const joinSubtitle = document.querySelector('.join-subtitle');
                if (joinSubtitle) {
                    joinSubtitle.textContent = savedJoinSubtitle;
                }
            }
            
            // 加载轮播图片
            const savedCarouselImages = loadFromLocalStorage('carouselImages');
            if (savedCarouselImages && savedCarouselImages.length > 0) {
                applyCarouselImages(savedCarouselImages);
            }
            
            // 加载会员轮播样式设置
            const savedMemberSettings = loadFromLocalStorage('memberCarouselSettings');
            if (savedMemberSettings) {
                applyMemberStyleSettings(savedMemberSettings);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            try {
                initializePage();
                // 初始化轮播功能
                initCarousel();
                // 初始化兴趣轮播功能
                initInterestCarousel();
                // 初始化会员头像轮播
                initMembersCarousel();
                // 启动自动轮播
                startAutoCarousel();
                // 启动兴趣轮播自动播放
                startAutoInterestCarousel();
                // 初始化编辑模式
                initEditMode();
                // 加载保存的内容
            loadSavedContent();
            
            // 加载保存的兴趣轮播图片
            loadSavedInterestImages();
            
            // 加载保存的推荐活动
            loadSavedActivityCards();
            
            // 恢复操作历史
            loadOperationHistory();
            } catch (error) {
                // 静默处理错误
            }
        });
        
        // 加载保存的推荐活动
        function loadSavedActivityCards() {
            const savedActivities = loadFromLocalStorage('activityCards');
            if (savedActivities && savedActivities.length > 0) {
                applyActivityCards(savedActivities);
            }
        }

    </script>

    <!-- 图片编辑模态框 -->
    <div id="imageEditModal" class="image-edit-modal" style="display: none;">
        <div class="modal-overlay" onclick="closeImageEditModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>🖼️ 编辑图片</h3>
                <button onclick="closeImageEditModal()" class="close-btn">×</button>
            </div>
            <div class="modal-body">
                <!-- 动态内容将在这里插入 -->
            </div>
        </div>
    </div>

</body>
</html>